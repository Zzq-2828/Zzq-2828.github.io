<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="朱章齐的个人技术网站" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>Advanced topics in electrical and electronic engineering |  Keep Making Progress</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="Keep Making Progress" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-ELEC7078"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Advanced topics in electrical and electronic engineering
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/05/19/ELEC7078/" class="article-date">
  <time datetime="2022-05-18T17:31:41.000Z" itemprop="datePublished">2022-05-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/HKU/">HKU</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">12.5k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">77 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <p>Hong Kong University 2022 summer semester class review —— ELEC7078 Advanced topics in electrical and electronic engineering</p>
<span id="more"></span>



<h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><h4 id="1-1-Distributed-System"><a href="#1-1-Distributed-System" class="headerlink" title="1.1 Distributed System"></a>1.1 Distributed System</h4><ul>
<li>A distributed system is defined as a collection of autonomous computers linked by a network with software designed to produce an integrated computing facility.</li>
<li>A distributed system is a collection of independent computers that appear to the system as a single computer.</li>
<li>Distributed System &#x3D; Collection of computers + Communication Network + Transparency</li>
</ul>
<img src="https://pic.imgdb.cn/item/628532c40947543129f036da.jpg" style="zoom: 50%;" />

<h4 id="1-2-Advantages-of-Distributed-Systems"><a href="#1-2-Advantages-of-Distributed-Systems" class="headerlink" title="1.2 Advantages of Distributed Systems"></a>1.2 Advantages of Distributed Systems</h4><ul>
<li>Price&#x2F;performance<ul>
<li>A cost-effective way to build larger system is to use a larger number of cheap CPUs.</li>
</ul>
</li>
<li>Nature of some applications<ul>
<li>Some applications are inherently distributed (e.g. banking and supermarket chain).</li>
</ul>
</li>
<li>Reliability<ul>
<li>If one machine crashes, the system as a whole can still survive.</li>
</ul>
</li>
<li>Incremental growth    <ul>
<li>Computing power can be added in small increments.</li>
</ul>
</li>
<li>Data sharing<ul>
<li>It allows many users access to a common database;</li>
</ul>
</li>
<li>Device sharing<ul>
<li>It allows many users to share expensive peripherals;</li>
</ul>
</li>
<li>Communication<ul>
<li>It provides communication facilities;</li>
</ul>
</li>
<li>Flexibility    <ul>
<li>It spreads the workload over the available machines in the most cost-effective way.</li>
</ul>
</li>
</ul>
<h4 id="Exercise-1"><a href="#Exercise-1" class="headerlink" title="Exercise(1)"></a>Exercise(1)</h4><p><strong>Give five types of hardware resource and five types of data or software resource that can usefully be shared. Give examples of their sharing as it occurs in practice in distributed systems.</strong></p>
<img src="https://pic.imgdb.cn/item/628a1c7c0947543129184fe0.jpg" style="zoom: 80%;" />

<img src="https://pic.imgdb.cn/item/628a1caf09475431291872b1.jpg" style="zoom:80%;" />





<h4 id="1-3-Characteristics"><a href="#1-3-Characteristics" class="headerlink" title="1.3 Characteristics"></a>1.3 Characteristics</h4><p><strong>Resource Sharing</strong></p>
<ul>
<li>What to share?<ul>
<li>Hardware devicesData</li>
</ul>
</li>
<li>How to share?<ul>
<li>Resources are stored in workstations and can be accessed via communications by a resource manager</li>
</ul>
</li>
<li>Resource Manager<ul>
<li>A program that offers a communication interface enabling the resource to be accessed, manipulated and updated reliably and consistently.</li>
</ul>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/628533b60947543129f0a7a2.jpg" style="zoom:80%;" />

<p><strong>Openness</strong></p>
<ul>
<li>Characteristic that determines whether the system can be extended in various ways</li>
<li>Hardware: Additional peripherals, memory or communication interfaces;</li>
<li>Software: Additional operating system features, communication protocols and resource-sharing services.</li>
</ul>
<p><strong>Concurrency</strong></p>
<ul>
<li>In a distributed system with M computers (cores) , up to M processes can be executed in parallel.</li>
<li>Parallel executions occur for two reasons:<ul>
<li>More than one users simultaneously invoke commands or interact with application programs</li>
<li>Many server processes run concurrently, each responding to different requests from client processes.</li>
</ul>
</li>
</ul>
<p><strong>Scalability</strong></p>
<ul>
<li>DS can be existed in different scale:</li>
<li>The smallest: 2 workstations + 1 file server</li>
<li>Local area network (LAN): <ul>
<li>hundreds workstations </li>
<li>Several file servers</li>
<li>Print servers</li>
</ul>
</li>
<li>Internetwork:<ul>
<li>Several LANS interconnected</li>
</ul>
</li>
</ul>
<p><strong>Fault Tolerance</strong></p>
<ul>
<li>The design of fault-tolerant computer systems is based on:<ul>
<li>Hardware redundancy: the use of redundant components</li>
<li>Software recovery: the design of programs to tolerate (process group) or recover from faults</li>
</ul>
</li>
</ul>
<p><strong>Transparency</strong></p>
<ul>
<li>Hidden from the user (application) programmer of separation of components;</li>
<li>Achieve a single system image to make everyone into thinking that the collection of machines is simply an old-fashioned time-sharing system.</li>
<li>Access transparency <ul>
<li>Enable local and remote information to be accessed using identical operations.</li>
</ul>
</li>
<li>Location transparency <ul>
<li>Enable the information objects to be accessed without knowledge of their location (users need not tell where resources are located).</li>
</ul>
</li>
<li>Concurrency transparency <ul>
<li>Enable several processes to operate concurrently using shared information objects without interference (multiple users can share resources automatically).</li>
</ul>
</li>
<li>Replication transparency <ul>
<li>Enable multiple replicas to be used to increase reliability and performance without user knowledge of how many replicas exist.</li>
</ul>
</li>
<li>Failure transparency <ul>
<li>Enable concealment of faults, allowing users to complete their tasks despite the failure of hardware or software components.</li>
</ul>
</li>
<li>Migration transparency <ul>
<li>Allow information objects move within a system without changing their name or affecting users.</li>
</ul>
</li>
<li>Performance transparency <ul>
<li>Allow the system to be configured to improve performance as loads vary.</li>
</ul>
</li>
<li>Scaling transparency <ul>
<li>Allow the system and applications to expand in scale without change to the system structure or the application algorithms.</li>
</ul>
</li>
<li>Parallelism transparency <ul>
<li>Allow the program to be executed in parallel without users knowledge.</li>
</ul>
</li>
</ul>
<h4 id="1-4-User-Requirements"><a href="#1-4-User-Requirements" class="headerlink" title="1.4 User Requirements"></a>1.4 User Requirements</h4><p><strong>Functionality</strong></p>
<p>A distributed system should bring an improvement over the services provided by any single computer through enhancements of:</p>
<ul>
<li>Sharing across a network can bring access to a richer variety of resources.</li>
<li>Parallel and Fault-tolerant applications.</li>
</ul>
<p>How to migrate a multi-user centralized computing to distributed computing? </p>
<ul>
<li>Adapt existing operating systems<ul>
<li>Continue to use existing operating system software that has been adapted for networking.</li>
<li>e.g. add servers to UNIX or Sun Network File System.</li>
</ul>
</li>
<li>Move to an entirely new operating system designed specifically for distributed system.<ul>
<li>Existing software becomes unusable.</li>
</ul>
</li>
<li>Emulation<ul>
<li>Move to a new OS designed for DS which can emulate one or more existing OS.</li>
<li>Existing and new distribution software can run side-by-side.</li>
</ul>
</li>
</ul>
<p><strong>Re-configurability</strong></p>
<ul>
<li>Short-term<ul>
<li>A failed process, computer or network component is replaced by another, working counterpart.</li>
<li>Overload is shifted from over-loaded to less-loaded machines to increase the total throughput of the DS.</li>
<li>To reduce network communications, data are moved from a machines to the others to make the data accessible.</li>
</ul>
</li>
<li>Medium&#x2F;long term evolution<ul>
<li>To accommodate heterogeneous components and assign new task or to upgrade the existing machines.</li>
</ul>
</li>
</ul>
<p><strong>Quality of Service</strong></p>
<ul>
<li>Performance<ul>
<li>Speed up the response of software components in a distributed system;</li>
</ul>
</li>
<li>Reliability and availability<ul>
<li>Fault-tolerance;</li>
</ul>
</li>
<li>Security<ul>
<li>Apply a reasonable degree of security applied to the data stored and transmitted with a distributed system.</li>
</ul>
</li>
</ul>
<h4 id="1-5-Basic-Design-Issues"><a href="#1-5-Basic-Design-Issues" class="headerlink" title="1.5 Basic Design Issues"></a>1.5 Basic Design Issues</h4><ul>
<li>Naming<ul>
<li>Name resources or objects in order to access them.</li>
</ul>
</li>
<li>Communication<ul>
<li>Optimize the communication implementations in distributed systems while retaining a high level programming model for its use.</li>
</ul>
</li>
<li>Software structure<ul>
<li>Define interface and good abstraction of data and services.</li>
</ul>
</li>
<li>Workload allocation<ul>
<li>Deploy computers and communications to achieve optimum performance and use of resources.</li>
</ul>
</li>
<li>Consistency maintenance<ul>
<li>How to balance consistency &amp; performance?</li>
</ul>
</li>
<li>Security<ul>
<li>How to secure message transfer in a distributed system?</li>
</ul>
</li>
</ul>
<h4 id="Exercise-2-3"><a href="#Exercise-2-3" class="headerlink" title="Exercise(2)(3)"></a>Exercise(2)(3)</h4><p><strong>List the three main software components that may fail when a client process invokes a method in a server object, giving an example of a failure in each case. To what extent are these failures independent of one another?</strong> </p>
<p>The three main software components that may fail are:</p>
<ul>
<li>the client process e.g. it may crash</li>
<li>the server process e.g. the process may crash</li>
<li>the communication software e.g. a message may fail to arrive</li>
</ul>
<p>The failures are generally caused independently of one another. Examples of dependent failures:</p>
<ul>
<li>if the loss of a message causes the client or server process to crash. (The crashing of a server would cause a client to perceive that a reply message is missing and might indirectly cause it to fail).</li>
<li>if clients crashing cause servers problems.</li>
<li>if the crash of a process causes a failures in the communication software.</li>
</ul>
<p><strong>Suggest how the components can be made to tolerate one another’s failures.</strong> </p>
<p>Both processes should be able to tolerate missing messages. </p>
<ul>
<li>The client must tolerate a missing reply message after it has sent an invocation request message. Instead of making the user wait forever for the reply, a client process could use a timeout and then tell the user it has not been able to contact the server.</li>
<li>A simple server just waits for request messages, executes invocations and sends replies. It should be absolutely immune to lost messages. But if a server stores information about its clients it might eventually fail if clients crash without informing the server (so that it can remove redundant information). </li>
<li>The communication software should be designed to tolerate crashes in the communicating processes.</li>
</ul>
<p>For example, the failure of one process should not cause problems in the communication between the surviving<br>processes.</p>
<p><strong>Compare and contrast cloud computing with more traditional client server computing, what is novel about cloud computing as a concept?</strong></p>
<p>Hardware: </p>
<ul>
<li>CPU: compute server (executes processor-intensive applications for clients), remote object server (executes methods on behalf of clients), worm program (shares cpu capacity of desktop machine with the local user). Most other servers, such as file servers, do some computation for their clients, hence their cpu is a shared resource. </li>
<li>memory: cache server (holds recently-accessed web pages in its RAM, for faster access by other local computers) </li>
<li>disk: file server, virtual disk server (see Chapter 8), video on demand server (see Chapter 15). </li>
<li>screen: Network window systems, such as X-11, allow processes in remote computers to update the content of windows. </li>
<li>printer: networked printers accept print jobs from many computers. managing them with a queuing system. </li>
<li>network capacity: packet transmission enables many simultaneous communication channels (streams of data) to be transmitted on the same circuits.</li>
</ul>
<p>Data&#x2F;software: </p>
<ul>
<li>web page: web servers enable multiple clients to share read-only page content (usually stored in a file, but sometimes generated on-the-fly). </li>
<li>file: file servers enable multiple clients to share read-write files. Conflicting updates may result in inconsistent results. Most useful for files that change infrequently, such as software binaries. </li>
<li>object: possibilities for software objects are limitless. E.g. shared whiteboard, shared diary, room booking system, etc</li>
<li>database: databases are intended to record the definitive state of some related sets of data. They have been shared ever since multi-user computers appeared. They include techniques to manage concurrent updates. </li>
<li>newsgroup content: The netnews system makes read-only copies of the recently-posted news items available to clients throughout the Internet. A copy of newsgroup content is maintained at each netnews server that is an approximate replica of those at other servers. Each server makes its data available to multiple clients. </li>
<li>video&#x2F;audio stream: Servers can store entire videos on disk and deliver them at playback speed to multiple clients simultaneously. </li>
<li>exclusive lock: a system-level object provided by a lock server, enabling several clients to coordinate their use of a resource (such as printer that does not include a queuing scheme).Distributed</li>
</ul>
<h3 id="2-Inter-process-Communication"><a href="#2-Inter-process-Communication" class="headerlink" title="2. Inter-process  Communication"></a>2. Inter-process  Communication</h3><p>进程间通信IPC</p>
<p><strong>Why we need Inter-process Communication (IPC)?</strong></p>
<ul>
<li>The components of a distributed system are <u>both logically and physically separated</u></li>
<li>They must communicate in order to interact.</li>
</ul>
<img src="https://pic.imgdb.cn/item/628537cb0947543129f29b82.jpg" style="zoom:67%;" />

<h4 id="2-1-Communication-Patterns"><a href="#2-1-Communication-Patterns" class="headerlink" title="2.1 Communication Patterns"></a>2.1 Communication Patterns</h4><ul>
<li><p>Client-server communication </p>
<ul>
<li>request and reply messages provide the basis for communication between clients and servers.</li>
<li>The idea of the model is to structure the distributed systems as a group of cooperating processes, i.e. the servers, that offer services to the users, namely, the clients.</li>
</ul>
<img src="C:\Users\win10\AppData\Roaming\Typora\typora-user-images\image-20220519024605386.png" alt="image-20220519024605386" style="zoom:67%;" />
</li>
<li><p>Group communication</p>
<ul>
<li><p>some messages are sent to several processes in a group.</p>
</li>
<li><p>Applications are composed of large numbers of peer processes running on separate computers and the pattern of communication between them depends entirely on application requirements.</p>
<img src="https://pic.imgdb.cn/item/62853f710947543129f5f028.jpg" style="zoom: 50%;" /></li>
</ul>
</li>
</ul>
<h4 id="2-2-Data-Passing"><a href="#2-2-Data-Passing" class="headerlink" title="2.2 Data Passing"></a>2.2 Data Passing</h4><ul>
<li>For any two computers to exchange data value, we need to map data structures and data items to messages.</li>
<li>Data structure must be flattened before transmission and rebuilt on arrival.  (I.e., flattening of structured data into a sequence of basic data)</li>
<li>On receiving data stream, the data structure must be rebuilt.</li>
<li>Marshalling<ul>
<li>the process of taking a collection of data items and assembling them into a form suitable for transmission in a message;</li>
</ul>
</li>
<li>Unmarshalling<ul>
<li>the process of disassembling them on arrival to produce an equivalent collection of data items at the destination;</li>
</ul>
</li>
<li>Usually a language preprocessor (interface compiler) can be used to generate marshalling &#x2F; unmarshalling operations automatically.</li>
<li>When an IPC primitive is encountered involving data item of the above type, the preprocessor generates code to do the marshalling (for a send) or unmarshalling (for a receive) based on the type description.</li>
</ul>
<p><strong>JSON (JavaScript Object Notation)</strong></p>
<img src="https://pic.imgdb.cn/item/628540bd0947543129f678bf.jpg" style="zoom:67%;" />

<h4 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h4><p><strong>Describe and illustrate the client-server architecture of one or more major Internet applications</strong></p>
<p><strong>Web</strong></p>
<img src="https://pic.imgdb.cn/item/628a23fe09475431291dbee4.jpg" style="zoom:80%;" />

<p>Browsers are clients of Domain Name Servers (DNS) and web servers (HTTP). Some intranets are configured to interpose a Proxy server. Proxy servers fulfil several purposes – when they are located at the same site as the client, they reduce network delays and network traffic. When they are at the same site as the server, they form a security checkpoint (see pp. 107 and 271) and they can reduce load on the server. </p>
<p>N.B. DNS servers are also involved in all of the application architectures described below, but they ore omitted from the discussion for clarity</p>
<p><strong>Describe and illustrate the peer-to-peer architecture of one or more major Internet applications</strong></p>
<h4 id="2-3-Synchronization"><a href="#2-3-Synchronization" class="headerlink" title="2.3 Synchronization"></a>2.3 Synchronization</h4><p>同步</p>
<ul>
<li>A central issue in the communication structure;</li>
<li>2 types of operations<ul>
<li>Blocking: the invocation blocks the execution of its invoker.</li>
<li>Non-blocking: the invocation does not block the execution of its invoker.</li>
</ul>
</li>
</ul>
<p><strong>Blocking</strong></p>
<p>阻塞</p>
<ul>
<li><p>Blocking Send</p>
<ul>
<li>Issuing process blocks (i.e., control is not passed back) until the message has been sent and received.</li>
</ul>
</li>
<li><p>Blocking Receive</p>
<ul>
<li>Issuing process blocks until a message has arrived and passed to the process.</li>
</ul>
<img src="https://pic.imgdb.cn/item/6285420d0947543129f6f1cc.jpg" style="zoom: 67%;" /></li>
</ul>
<h5 id="Blocking-vs-Non-blocking"><a href="#Blocking-vs-Non-blocking" class="headerlink" title="Blocking vs. Non-blocking"></a>Blocking vs. Non-blocking</h5><p><strong>Non-blocking</strong></p>
<ul>
<li><p>Non-blocking send</p>
<ul>
<li>Issuing process continues (i.e. control is passed back) execution after the message has been copied out of the process’s environment.</li>
</ul>
</li>
<li><p>Non-blocking receive</p>
<ul>
<li>Issuing process continues if there is no message waiting to be received. Receiver process will have to be notified later on message arrival, either by polling or interrupt mechanism.</li>
</ul>
<img src="C:\Users\win10\AppData\Roaming\Typora\typora-user-images\image-20220519030126394.png" alt="image-20220519030126394" style="zoom: 67%;" /></li>
</ul>
<h5 id="Synchronous-vs-Asynchronous-Communication"><a href="#Synchronous-vs-Asynchronous-Communication" class="headerlink" title="Synchronous vs. Asynchronous Communication"></a>Synchronous vs. Asynchronous Communication</h5><ul>
<li>Drawback: Can lead to inefficiency due to waiting<ul>
<li>high overhead and less efficiency.</li>
</ul>
</li>
<li>Solution: time-out<ul>
<li>Receive (A, msg, TO);<ul>
<li>If a message is not arrived in TO seconds, the process will be unblocked (and the receive operation aborted).</li>
</ul>
</li>
<li>Send (B, msg, TO)<ul>
<li>Sender blocks and if the message is not received in TO seconds, the process will be unblocked.</li>
</ul>
</li>
</ul>
</li>
<li>Synchronous communication<ul>
<li>Blocking send and blocking receive;</li>
<li>Sender and receiver synchronize at point of message transfer.</li>
<li>Advantage: <ul>
<li>Can make definite assumptions on message send and receipt </li>
<li>Easy design and control of the distributed processes</li>
</ul>
</li>
</ul>
</li>
<li>Asynchronous communication<ul>
<li>Sender and receiver do not synchronize at message transfer.</li>
<li>Non-blocking send + non-blocking receive;</li>
<li>Non-blocking send + blocking receive (usual combination);</li>
</ul>
</li>
<li>More flexible and potentially more parallelism;</li>
<li>Less assumption can be said about sending and receiving - more difficult to verify program properties.</li>
<li>Non-blocking send requires buffering of messages.</li>
</ul>
<h4 id="2-4-Implementation"><a href="#2-4-Implementation" class="headerlink" title="2.4 Implementation"></a>2.4 Implementation</h4><p><strong>Process Location</strong></p>
<ul>
<li><p>A port is a location independent identifier which can be mapped into low-level address in order to deliver message.</p>
</li>
<li><p>In TCP&#x2F;IP, message destination addresses are Port number (used by the process) and Internet address of the computer (the process resides on), </p>
<ul>
<li>Send (portB, msg); </li>
<li>Receive(portB, msg);</li>
</ul>
<img src="https://pic.imgdb.cn/item/6285473f0947543129f8ece7.jpg" style="zoom:50%;" /></li>
</ul>
<p><strong>Unreliable vs. Reliable Messages</strong></p>
<ul>
<li>Unreliable message is used to refer to a single message transmitted from sender to receiver, without acknowledgement or retries. <ul>
<li>e.g. UDP only makes its “best effort” to deliver a message.</li>
</ul>
</li>
<li>Reliable message delivery may be constructed from an unreliable one by using acknowledgement.<ul>
<li>Positive ack: receivers send ack message whenever a message is received.</li>
<li>Negative ack: Receivers do not send ack message until something wrong (timeout or receiving any incorrect message).</li>
</ul>
</li>
</ul>
<p><strong>Client-Server Communication Protocol</strong></p>
<ul>
<li><p>Client-server model uses request-reply communication.</p>
<ul>
<li>Request-reply is normally synchronous because a client will wait for the reply.</li>
<li>Request-reply can be asynchronous in case that the client can afford to retrieve replies later.</li>
</ul>
<img src="https://pic.imgdb.cn/item/628549210947543129f97a72.jpg" style="zoom:67%;" />
</li>
<li><p>Communication failures</p>
<ul>
<li><u>Loss of request message</u>: communication link fails &#x2F; network switch fails &#x2F; receiver’s node is down.</li>
<li><u>Loss of reply message</u>: communication link fails &#x2F; network switch fails &#x2F; sender’s node is down.</li>
<li><u>Unsuccessful execution of the request</u>: server crashes while executing the request.</li>
</ul>
</li>
<li><p>In the presence of communication failures three protocols are used for implementing various type of client-server communication.</p>
</li>
<li><p>The <strong>request (R)</strong> protocol</p>
<ul>
<li>Client issues a Send (server-id, request) and continues. It is suitable for cases in which there is no reply required from the server and that the client requires no confirmation that the request has been carried out.</li>
</ul>
<img src="https://pic.imgdb.cn/item/628549930947543129f9a33f.jpg" style="zoom:50%;" />
</li>
<li><p>The <strong>request-reply (RR)</strong> protocol</p>
<ul>
<li>Most commonly used; </li>
<li>The reply message from the server also acts as acknowledgment to the original request message.</li>
<li>A subsequent request from the client may be regarded as an acknowledgment of the server’s message.</li>
</ul>
<img src="https://pic.imgdb.cn/item/628549e40947543129f9b76d.jpg" style="zoom: 50%;" />
</li>
<li><p>The <strong>request-reply-acknowledge reply (RRA)</strong> protocol</p>
<ul>
<li>An acknowledgement will be sent back to the server after received the reply</li>
<li>The ack includes the request-Id and acknowledges all request messages up to that request-Id.</li>
<li>Although the exchange involves an additional message, it need not block the client as the acknowledgement may be transmitted after the reply has been given to the client, but it does use processing and network resources.</li>
</ul>
<img src="https://pic.imgdb.cn/item/62854a230947543129f9c86c.jpg" style="zoom:50%;" /></li>
</ul>
<h4 id="2-5-Other-Issues"><a href="#2-5-Other-Issues" class="headerlink" title="2.5 Other Issues"></a>2.5 Other Issues</h4><ul>
<li><p><strong>Time-out</strong> </p>
<ul>
<li><p>occur when a request message is lost or the network becomes partitioned, or the server is overloaded (and hence slow); or the reply message is lost.</p>
</li>
<li><p>DoOperation repeats sending the request message N times (time-outs) before reporting failure.</p>
</li>
<li><p>It is impossible to distinguish between a process failure and a communication failure. When process does not reply after some agreed number, N of attempts to communicate with it, it is assumed to be unavailable. </p>
</li>
<li><p>The choice of N is difficult (?).</p>
</li>
</ul>
</li>
<li><p><strong>Duplicated request messages</strong></p>
<ul>
<li>Occur when request message is retransmitted (on time-outs).</li>
<li>Duplicates can be detected using Request-Id (like a sequence number) and discarded.</li>
</ul>
</li>
<li><p><strong>Lost reply messages</strong></p>
<ul>
<li>If the server has already sent the reply message, it may need to execute the request again to obtain the result. Re-executing is only possible for idempotent operation.</li>
</ul>
</li>
<li><p>An <u>idempotent operation</u>（幂等运算） is an operation that <u>can be performed repeatedly with the same effect</u> as if it had been performed exactly once.</p>
</li>
<li><p>If server operation is not idempotent a record of past results (called history) can be kept. History can be kept from growing too large by using the RAA protocol, or discarding results which have passed a certain time limit.</p>
</li>
<li><p>Multipacket  messages</p>
<ul>
<li>Datagram with limited length (often as 8 kbytes).</li>
<li>Not enough if a request or reply is too large.</li>
<li>Solution with multipacket: a message made up of a sequence of datagrams.</li>
<li>Drawbacks: complicated in design and control (receive in sequence), low efficiency in retransmission.</li>
</ul>
</li>
</ul>
<h3 id="3-Time-in-Distributed-Systems"><a href="#3-Time-in-Distributed-Systems" class="headerlink" title="3. Time in Distributed Systems"></a>3. Time in Distributed Systems</h3><p>Time is an important and interesting issue in distributed systems because</p>
<ul>
<li>Internal (computer-to-computer) and external (computer-to-external)  synchronization;</li>
<li>Many algorithms depend upon clock synchronization, e.g. transaction.</li>
</ul>
<h4 id="3-1-Synchronizing-Physical-Clocks"><a href="#3-1-Synchronizing-Physical-Clocks" class="headerlink" title="3.1 Synchronizing Physical Clocks"></a>3.1 Synchronizing Physical Clocks</h4><ul>
<li>Physical clocks</li>
<li>Electronic devices that count oscillations occurring in a crystal at a definite frequency. </li>
<li>It is useful for keeping accurate time and time-stamping events, e.g., time in accounting records of connection. </li>
<li><u>Event is an action that appears to occur indivisibly（不可分割地）.</u></li>
<li><strong>Sources of accurate timing signals:</strong> <ul>
<li>coordinated universal time (UTC)</li>
<li>Radio broadcast accuracy: 0.1 - 10 ms Satellite (Geostationary Operational Environment Satellite GOES) accuracy: 1 ms</li>
<li>Satellite (Global Positional System GPS) accuracy: 0.1 ms</li>
</ul>
</li>
<li><strong>Difficulties in distributed systems</strong><ul>
<li><u>Not all sites have direct access to accurate time sources</u> such as GPS receivers.</li>
<li>Sites have to synchronize their local clocks with those have more accurate time. </li>
<li>Synchronization needs to be done periodically due to clock drift: they count time at different rates, and so diverge.（需要周期性同步）</li>
</ul>
</li>
</ul>
<h5 id="Cristian’s-method"><a href="#Cristian’s-method" class="headerlink" title="Cristian’s method"></a>Cristian’s method</h5><p>A central time server process S supplies the time according to its clock upon request.</p>
<img src="https://pic.imgdb.cn/item/62854d0d0947543129fa8e50.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/62854d320947543129fa976c.jpg" style="zoom:67%;" />

<ul>
<li>If a process P requests the time in a message m<sub>r</sub>, and receives the time value t  in a message m<sub>t</sub>, then it could set its clock to the time t + T<sub>trans</sub>, where T<sub>trans</sub> is the time taken to transmit m<sub>t</sub> from the server S to P.</li>
<li>T<sub>trans</sub> can be variant. We may say, T<sub>trans</sub> &#x3D; min + x, where x &#x3D; 0 and min is the time of message transmission if no other processes and no other messages. </li>
<li>min can be measured or conservatively estimated but x is still unknown!</li>
</ul>
<img src="https://pic.imgdb.cn/item/62865cdb0947543129c30757.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/62865cf60947543129c3131e.jpg" style="zoom:67%;" />

<ul>
<li>Let T<sub>round</sub> be the total round trip time to send the request m<sub>r</sub> and receive the reply m<sub>t</sub>, then <strong>P should estimate its clock as t + T<sub>round</sub> &#x2F; 2</strong> (T<sub>round</sub> can be measured or conservatively estimated ).</li>
<li><strong>The accuracy is ±(T<sub>round</sub> &#x2F; 2 - min).</strong></li>
<li>Problem: single-server failure.</li>
<li>Solution: group synchronization time server.</li>
</ul>
<img src="https://pic.imgdb.cn/item/628660320947543129c4717a.jpg" style="zoom:67%;" />

<h5 id="Exercise-1"><a href="#Exercise-1" class="headerlink" title="Exercise"></a>Exercise</h5><p>Consider a host using Cristian’s method to synchronize its clock with a time server T and got the following records. Assume the total delay of transmitting a message from the host to the time server or vice versa is 10ms.</p>
<img src="https://pic.imgdb.cn/item/6286622c0947543129c52ac0.jpg" style="zoom:80%;" />

<ul>
<li><p>Which of these times should be used to set its clock?  To what time should it set? Estimate the accuracy of the setting.</p>
<p><strong>The message with minimal delay should be chosen, which is message 2 — 24ms (14:22:10.564)</strong></p>
<p><strong>Time&#x3D;14:22:10.564+12ms&#x3D;14:22:10.576</strong></p>
<p><strong>Accuracy: 12-min&#x3D;+&#x2F;- 2ms</strong></p>
</li>
<li><p>What will the answer of part (a) change if the total delay is 9ms?</p>
<p><strong>Time&#x3D;No change</strong></p>
<p><strong>Accuracy: +&#x2F;-3ms</strong></p>
</li>
<li><p>If it is required to synchronize the host’s to within +&#x2F;- 1 ms. Discuss how to achieve it. Assume 9ms total delay is used</p>
<p><strong>Keep synchronize until the round-trip is 20ms</strong></p>
</li>
</ul>
<h5 id="The-Berkeley-algorithm"><a href="#The-Berkeley-algorithm" class="headerlink" title="The Berkeley algorithm"></a>The Berkeley algorithm</h5><ul>
<li><p>An algorithm for internal synchronization in BSD UNIX.</p>
</li>
<li><p>(Unlike Cristian’s) In a group sites, <u>one is chosen as coordinator (master)</u>. It periodically polls the other sites (slaves) to synchronize their clocks.</p>
</li>
<li><p>Master estimates the slaves’ clock times by observing round trip time (like Cristian’s). It averages the time obtained (including its own).</p>
</li>
<li><p>The average (with probabilities) can cancel out individual clock’s run fast or slow.</p>
</li>
<li><p>Accuracy depends on round-trip time between master and slaves.</p>
</li>
<li><p>Master sends time rate adjust value (+ or -) to slaves, requesting them to adjust their time rates.</p>
</li>
<li><p>Master takes fault-tolerant average.</p>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/628665af0947543129c6a016.jpg" style="zoom:67%;" />

<h5 id="Exercise-2"><a href="#Exercise-2" class="headerlink" title="Exercise"></a>Exercise</h5><p>A group of servers using Berkeley algorithm to synchronize their physical clocks.  The coordinator received the following replies:</p>
<img src="https://pic.imgdb.cn/item/628668a60947543129c7f470.jpg" style="zoom: 80%;" />

<ul>
<li><p>What is the clock difference between the coordinator and members?  Give the answer with respect to the coordinator.</p>
<img src="https://pic.imgdb.cn/item/628669090947543129c81cdc.jpg" style="zoom:80%;" />
</li>
<li><p>Draft the messages to be sent to each member and what should the member do after receiving the message?</p>
<img src="https://pic.imgdb.cn/item/62866b140947543129c8e8d4.jpg" style="zoom:80%;" />
</li>
<li><p>What if the clock of member C is running faster than the coordinator by 100ms? What is the potential problem of setting the clock value immediately based on the new adjustment?</p>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/62866d7b0947543129c9d862.jpg" style="zoom:80%;" />

<h5 id="Network-Time-Protocol-NTP"><a href="#Network-Time-Protocol-NTP" class="headerlink" title="Network Time Protocol (NTP)"></a>Network Time Protocol (NTP)</h5><ul>
<li>A standard for clock synchronization throughout the Internet</li>
<li>Design aims and features<ul>
<li>To provide a service enabling clients across the Internet to be synchronized accurately to UTC;<ul>
<li>Employs statistical techniques for the filtering of timing data and it discriminates between the quality of timing data from different servers</li>
</ul>
</li>
<li>To provide a reliable service to losses of connectivity;<ul>
<li>Redundant servers and paths</li>
</ul>
</li>
<li>To enable clients to resynchronize sufficiently frequently;<ul>
<li>Scale to large numbers of client and servers</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/628671f10947543129cc387c.jpg" style="zoom: 67%;" />

<ul>
<li>NTP server synchronize - UDP<ul>
<li>Multicast mode <ul>
<li>high speed LAN</li>
<li>Multicast periodically</li>
</ul>
</li>
<li>Procedure call mode<ul>
<li>Similar to the operation of Cristian’s algorithm</li>
<li>More accurate than multicast mode</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-2-Casual-Ordering-Happens-before"><a href="#3-2-Casual-Ordering-Happens-before" class="headerlink" title="3.2 Casual Ordering (Happens-before)"></a>3.2 Casual Ordering (Happens-before)</h4><p>Causal ordering</p>
<ul>
<li>x &lt;  y <ul>
<li>x and y are different events of the same process and x occurs before y</li>
</ul>
</li>
<li>s  &lt;  r<ul>
<li>s is a send event and r is the corresponding receive event</li>
</ul>
</li>
<li>y &lt; r <ul>
<li>y&lt;s and s&lt;r</li>
</ul>
</li>
</ul>
<p>Happen before: if  a &lt; b</p>
<img src="https://pic.imgdb.cn/item/6286761f0947543129cd9c26.jpg" style="zoom: 67%;" />

<img src="https://pic.imgdb.cn/item/6286763d0947543129cda652.jpg" style="zoom: 50%;" />

<ul>
<li><p>a &#x3D;&gt; b, b &#x3D;&gt; c, c &#x3D;&gt; d, d &#x3D;&gt; f  &#x3D;&#x3D;&#x3D;&gt; a &#x3D;&gt; f.</p>
<ul>
<li>a and e that are not ordered by &#x3D;&gt; are concurrent（并行的）, and write this a||e.</li>
<li>Logical clock can capture happened-before relation.</li>
<li>It is a monotonically increasing software counter, whose value need bear no particular relationship to any physical clock.</li>
</ul>
</li>
<li><p>Causal Order : If a &#x3D;&gt; b then a &lt; b</p>
<ul>
<li>a and b are causally related if  a &#x3D;&gt; b  or b &#x3D;&gt; a</li>
<li>a and b are independent if not a &#x3D;&gt; b  and not b &#x3D;&gt; a</li>
</ul>
</li>
</ul>
<h4 id="3-3-Logical-Time-x2F-Virtual-Time-x2F-Logical-Clock"><a href="#3-3-Logical-Time-x2F-Virtual-Time-x2F-Logical-Clock" class="headerlink" title="3.3 Logical Time &#x2F; Virtual Time &#x2F; Logical Clock"></a>3.3 Logical Time &#x2F; Virtual Time &#x2F; Logical Clock</h4><ul>
<li>Objective:<ul>
<li>Create virtual time without generating additional message</li>
</ul>
</li>
<li>Each entity x creates and maintains a logical clock C<sub>x</sub></li>
<li>For each event a occurring at x, C(a)&#x3D;C<sub>x</sub>(a)</li>
<li>Denote the timestamp of event a at p by C<sub>p</sub>(a) and the timestamp of event b at whatever process it occurred by C(b).</li>
</ul>
<p><strong>To capture the happened-before relation &#x3D;&gt;, we have the following rules:</strong></p>
<ul>
<li>LC1: <strong>C<sub>p</sub> is incremented before each event is issued at process p: C<sub>p</sub> :&#x3D; C<sub>p</sub> + 1.</strong></li>
<li>LC2:  When a process <strong>p</strong> sends a message <strong>m</strong>, it piggybacks on m the value <strong>t &#x3D; C<sub>p</sub></strong>.    On receiving (m,t), a process q computes <strong>C<sub>q</sub> :&#x3D; max(C<sub>q</sub>, t)</strong> and then applies LC1 before timestamping the event rcv(m).</li>
</ul>
<p>It guarantees a &#x3D;&gt; b     C(a) &lt; C(b).</p>
<img src="https://pic.imgdb.cn/item/628677750947543129ce0aa4.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/628677950947543129ce179e.jpg" style="zoom:67%;" />

<p><strong>Logical Clock</strong></p>
<img src="https://pic.imgdb.cn/item/628678020947543129ce37c8.jpg" style="zoom: 67%;" />

<h4 id="3-4-Vector-Clock"><a href="#3-4-Vector-Clock" class="headerlink" title="3.4 Vector Clock"></a>3.4 Vector Clock</h4><img src="https://pic.imgdb.cn/item/628678730947543129ce5851.jpg" style="zoom:67%;" />

<ul>
<li><p>Each entity x<sub>i</sub> is equipped with a local integer counter C<sub>i</sub> and increment its value by 1 at the beginning of every event like logical clock</p>
</li>
<li><p>Each entity X<sub>i</sub> is equipped with a n-dimensional vector V<sub>i</sub> of values, one for each entity in the network. The value of V<sub>i</sub>[i] is equal to C<sub>i</sub></p>
</li>
<li><p>The value of V<sub>i</sub>[j], i≠j is initially 0 and change only when a message arrives of X<sub>i</sub></p>
</li>
<li><p>Whenever an entity X<sub>i</sub> sends a message to a neighbor X<sub>j</sub>, it encloses the message the vector of values V<sub>i</sub></p>
</li>
<li><p>Whenever an entity X<sub>j</sub> processes the arrival of a message with a vector vect of values, it updates its local vector V<sub>j</sub> as follows: for all i≠j, it sets V<sub>j</sub>[i]:&#x3D;max{vect[i],V<sub>j</sub>[i]}</p>
</li>
<li><p>Partial Order</p>
<ul>
<li>A ≤ B if A[i] ≤ B[i] for all indices i</li>
</ul>
</li>
<li><p>Complete Causal Order</p>
<ul>
<li>A &lt; B if and only if A ≤ B and A[i] &lt; B[i] for at least an index i e.g. [2,4,3] &lt;[3,4,3]</li>
</ul>
</li>
<li><p>Property </p>
<ul>
<li>For any two events a and b at Xi, Vi(a)&lt;Vi(b) if and only if t(a)&lt;t(b)</li>
<li>If a is a sending event and b is a receiving event, then Vi(a)&lt;Vi(b)</li>
<li>a → b , then V(a)&lt;V(b)</li>
<li>V(a)&lt;V(b), then a → b??</li>
</ul>
</li>
</ul>
<h4 id="3-5-Exercise"><a href="#3-5-Exercise" class="headerlink" title="3.5 Exercise"></a>3.5 Exercise</h4><p>Consider the following events :</p>
<img src="https://pic.imgdb.cn/item/628679e30947543129ced4a5.jpg" style="zoom:67%;" />

<ul>
<li><p><strong>Assume the initial logical clocks of all process is zero, what are the logical clock values of E1, E4, E5, E8, E9 and E11?</strong></p>
<img src="https://pic.imgdb.cn/item/62867a230947543129cee7cf.jpg" style="zoom:80%;" />
</li>
<li><p><strong>What are the causal orders of E5 and E8, E6 and E9, and E2 and E11?</strong></p>
<p>E5 || E8, E6 -&gt; E9, E2-&gt;E11</p>
</li>
<li><p><strong>Can we work out the causal order of E2 and E11 by their logical clocks?</strong></p>
<p>No, although the clock value of E11 (11) is greater than E2 (1), there is no guarantee that E2 is happen before E11 (even E2 is actually happened before E11).  Consider E2 and E4, the clock value of E4 is greater than E2 but E2 and E4 are not causally related.  </p>
</li>
<li><p><strong>What are the vector clocks of E2 and E11? Can we work out the causal order of E2 and E11 by based on the vector clocks?</strong></p>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/62867a7d0947543129cf01bb.jpg" style="zoom: 80%;" />

<p>quiz:</p>
<img src="https://pic.imgdb.cn/item/6289dcd60947543129ec0c12.jpg" style="zoom:80%;" />



<h3 id="4-Distributed-Coordination"><a href="#4-Distributed-Coordination" class="headerlink" title="4. Distributed Coordination"></a>4. Distributed Coordination</h3><p>Wave and Traversal Algorithms</p>
<ul>
<li>Wave algorithms: Message passing schemes<ul>
<li>Broadcasting, synchronization and computing global functions</li>
</ul>
</li>
<li>Traversal algorithms: wave algorithms that the events of     <ul>
<li>computation are totally ordered by casuality</li>
</ul>
</li>
<li>Elementary tasks of most distributed algorithms<ul>
<li>Election, termination detection, mutual  exclusion</li>
</ul>
</li>
</ul>
<h4 id="4-1-Wave-Algorithms"><a href="#4-1-Wave-Algorithms" class="headerlink" title="4.1 Wave Algorithms"></a>4.1 Wave Algorithms</h4><ul>
<li><p>Distributed algorithms → collection of possible computations→ collection of events</p>
</li>
<li><p>Events are ordered partially (casual precedence relation)</p>
</li>
<li><p>A computation is a collection of events, partially ordered by the causal precedence relation</p>
</li>
<li><p>|C| &#x3D; number of events of computation C</p>
</li>
<li><p>C<sub>p</sub> &#x3D; event occur in process p</p>
</li>
<li><p>decide (event) &#x3D; internal event</p>
</li>
</ul>
<p>A wave algorithm exchanges a finite number of messages and then makes a decision</p>
<p><strong>Wave Algorithm Requirements</strong></p>
<img src="C:\Users\win10\AppData\Roaming\Typora\typora-user-images\image-20220520011829964.png" alt="image-20220520011829964" style="zoom: 50%;" />

<ul>
<li><p>Initiators &#x2F; Starters</p>
<ul>
<li>Starts the execution of its local algorithm spontaneously i.e. triggered by some condition internal to the process</li>
<li>First event: internal&#x2F; send</li>
</ul>
</li>
<li><p>Non-initiators &#x2F; followers</p>
<ul>
<li>Become involved in the algorithm only when a message of the algorithm arrives and triggers the execution of the process algorithm</li>
<li>First event: receive</li>
</ul>
</li>
<li><p>Centralization vs Decentralized</p>
<ul>
<li>Centralized &#x2F; single source: Exactly one </li>
<li>Decentralized &#x2F; multi-source: initiator are subset of the process</li>
</ul>
</li>
<li><p>Topology : ring, tree, clique</p>
<img src="https://pic.imgdb.cn/item/62867c520947543129cfa2f6.jpg" style="zoom: 50%;" />
</li>
<li><p>Initial Knowledge </p>
<ul>
<li>Process identities : each process initially knows its own unique name</li>
<li>Neighbors’ identities: each process initially knows the name of its neighbors</li>
<li>Sense of direction</li>
<li>Number of decisions: number of process execute a decide event</li>
<li>Complexity: number of exchanged messages</li>
</ul>
</li>
</ul>
<p><strong>Application of Wave</strong></p>
<ul>
<li>Propagation of Information with feedback (PIF)<ul>
<li>Some information must be broadcast to all processes and certain processes must receive a notification of when the broadcast is complete</li>
</ul>
</li>
<li>Synchronization<ul>
<li>In each process q an event aq must be executed and in some processes an event bp must be executed, such that the execution of all aq events must have taken place temporally before any of the bp events is executed. In SYN algorithm the bp events will be considered as decide events.</li>
</ul>
</li>
<li>Computation of Infimum Function<ul>
<li>Function must be computed whose value depends essentially on the input of every process.</li>
</ul>
</li>
</ul>
<h4 id="4-2-Ring-Algorithm"><a href="#4-2-Ring-Algorithm" class="headerlink" title="4.2 Ring Algorithm"></a>4.2 Ring Algorithm</h4><img src="https://pic.imgdb.cn/item/6286817d0947543129d1df00.jpg" style="zoom: 50%;" />

<img src="https://pic.imgdb.cn/item/628681a10947543129d1e7f8.jpg" style="zoom: 50%;" />

<h4 id="4-3-Tree-Algorithm"><a href="#4-3-Tree-Algorithm" class="headerlink" title="4.3 Tree Algorithm"></a>4.3 Tree Algorithm</h4><ul>
<li>All leaves of the tree initiate the algorithm</li>
<li>If a process has received a message via each of its incident channels except one, the process sends a message via the remaining channel</li>
<li>Each process sends exactly one message in the algorithm</li>
<li>If a process has received a message via all of its incident channels it decides</li>
</ul>
<img src="https://pic.imgdb.cn/item/628682350947543129d2107f.jpg" style="zoom:67%;" />

<h4 id="4-4-Echo-Algorithm"><a href="#4-4-Echo-Algorithm" class="headerlink" title="4.4 Echo Algorithm"></a>4.4 Echo Algorithm</h4><p>回波算法</p>
<ul>
<li>Initiator sends messages to all its neighbors</li>
<li>Upon receipt of the first message a non-initiator forwards messages to all its neighbors except the one from which the message was received</li>
<li>When a non-initiator has received messages from all its neighbors an echo is sent to the father</li>
<li>When the initiator has received a message from all its neighbors it decides.</li>
</ul>
<img src="https://pic.imgdb.cn/item/628682c30947543129d23785.jpg" style="zoom: 50%;" />

<img src="https://pic.imgdb.cn/item/628682df0947543129d23e0e.jpg" style="zoom:50%;" />

<h4 id="4-5-Polling-Algorithm"><a href="#4-5-Polling-Algorithm" class="headerlink" title="4.5 Polling Algorithm"></a>4.5 Polling Algorithm</h4><p>轮询算法</p>
<p>A process can decide if it has received a message from each neighbor</p>
<img src="https://pic.imgdb.cn/item/628683030947543129d2470b.jpg" style="zoom: 67%;" />

<h4 id="4-6-Phase-Algorithm"><a href="#4-6-Phase-Algorithm" class="headerlink" title="4.6 Phase Algorithm"></a>4.6 Phase Algorithm</h4><ul>
<li><p>The phase algorithm can be used in arbitrary directed networks, where channels can carry messages in one direction only</p>
</li>
<li><p>In-neighbors: processes that can send message to the node</p>
</li>
<li><p>Out-neighbors: processes to which the node can send message</p>
</li>
<li><p>Diameter of the network must be known</p>
</li>
<li><p>In the phase algorithm, each process sends exactly D messages to each out-neighbors</p>
<img src="https://pic.imgdb.cn/item/6286836e0947543129d265dd.jpg" style="zoom:80%;" /></li>
</ul>
<h4 id="4-7-Traversal-Algorithms"><a href="#4-7-Traversal-Algorithms" class="headerlink" title="4.7 Traversal Algorithms"></a>4.7 Traversal Algorithms</h4><p>遍历算法</p>
<p>The traversal algorithms has the following properties:</p>
<ul>
<li>In each computation there is one initiator which starts the algorithm by sending out exactly one message</li>
<li>A process, upon receipt of a message, either sends out one message or decides</li>
<li>The algorithm terminates in the initiator and when this happens, each process has sent a message at least once</li>
</ul>
<p>The first two properties imply that in each finite computation exactly one process decides. The algorithm is said to terminate in the single process that decides</p>
<p><strong>Traversing Cliques: Sequential Polling Algorithm</strong></p>
<img src="https://pic.imgdb.cn/item/6286848f0947543129d2b2d7.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/628685a20947543129d2f2eb.jpg" style="zoom:67%;" />

<p><strong>Traversing Connected Network: Tarry’s Algorithm</strong></p>
<ul>
<li>R1. A process never forwards the token twice through the same channel</li>
<li>R2. A non-initiator forwards the token to its father (the neighbor from which it first received the token) only if there is no other channel possible according to rule R1</li>
</ul>
<img src="https://pic.imgdb.cn/item/6286877e0947543129d36b31.jpg" style="zoom:50%;" />

<img src="https://pic.imgdb.cn/item/628687930947543129d37101.jpg" style="zoom:50%;" />

<img src="https://pic.imgdb.cn/item/628687ad0947543129d37796.jpg" style="zoom:50%;" />

<h3 id="5-Distributed-Mutual-Exclusion-and-Election"><a href="#5-Distributed-Mutual-Exclusion-and-Election" class="headerlink" title="5. Distributed Mutual Exclusion and Election"></a>5. Distributed Mutual Exclusion and Election</h3><p>分布式互斥与选举</p>
<h4 id="5-1-Distributed-Coordination"><a href="#5-1-Distributed-Coordination" class="headerlink" title="5.1 Distributed Coordination"></a>5.1 Distributed Coordination</h4><p>分布式协作</p>
<ul>
<li>Why do we need distributed coordination?<ul>
<li>To prevent interference and ensure consistency before accessing resources, e.g. NFS file system to share a common text file.</li>
</ul>
</li>
<li>Distributed Mutual Exclusion (DME)<ul>
<li>A single process being given a privilege - the right to access shared resources - temporarily before another process is granted it.</li>
</ul>
</li>
</ul>
<h4 id="5-2-Distributed-Mutual-Exclusion"><a href="#5-2-Distributed-Mutual-Exclusion" class="headerlink" title="5.2 Distributed Mutual Exclusion"></a>5.2 Distributed Mutual Exclusion</h4><p>分布式互斥</p>
<p>Basic requirements for DME concerning some resources:</p>
<ul>
<li><strong>ME1</strong>: (safety) At most one process may execute in the critical section (CS) at a time.</li>
<li><strong>ME2</strong>: (liveness and deadlock-free) A process requesting entry to the CS is eventually granted it (so long as any process executing in the CS eventually leaves it.)</li>
<li><strong>ME3</strong>: (ordering) Entry to the CS should be granted in happened-before order.</li>
</ul>
<p><strong>The central server algorithm: server manages a mutual exclusion token for a set of processes</strong></p>
<p>中央服务器算法:服务器为一组进程管理一个互斥令牌</p>
<img src="https://pic.imgdb.cn/item/62868b390947543129d456f8.jpg" style="zoom: 80%;" />

<ul>
<li><p>To employ a server that grants permission to enter a CS.</p>
</li>
<li><p>Assume only one CS is managed. The protocol is as follows:</p>
<img src="https://pic.imgdb.cn/item/62868b640947543129d479c1.jpg" style="zoom:67%;" />
</li>
<li><p>Satisfy ME1, ME2 and ME3.</p>
</li>
<li><p>Problem 1: the server could be performance bottleneck.</p>
</li>
<li><p>Problem 2: single point of failure.</p>
</li>
</ul>
<h5 id="5-2-1-DME-Ricart-and-Agrawala’s-algorithm"><a href="#5-2-1-DME-Ricart-and-Agrawala’s-algorithm" class="headerlink" title="5.2.1 DME: Ricart and Agrawala’s algorithm"></a>5.2.1 DME: Ricart and Agrawala’s algorithm</h5><ul>
<li><p>Based on distributed agreement;</p>
</li>
<li><p>No center server is required.</p>
</li>
<li><p>The basic idea is that processes that require entry to a critical section multicast a request message, and can enter it only when all the other processes have replied to this message. （需要进入临界区的进程多播请求消息，并且只有当所有其他进程都对该消息作出了响应时才能进入该消息）</p>
</li>
<li><p>Assumption: </p>
<ul>
<li>p<sub>1</sub>, …, p<sub>n</sub> know one another addresses. </li>
<li>All messages sent are eventually received and delivered</li>
<li>each pi keeps a logical clock, updated according to rules LC1 and LC2.</li>
</ul>
</li>
<li><p>Messages requesting the token are in the form &lt;T,pi&gt; where T is the sender timestamp and pi is the sender id.</p>
</li>
<li><p>Only one CS is concerned.</p>
</li>
<li><p>3 states: RELEASED, WANTED, HELD.</p>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/62879abe09475431297389bb.jpg" style="zoom:67%;" />

<p>**Protocol: **</p>
<img src="https://pic.imgdb.cn/item/62879aea0947543129739c3d.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/62879b0b094754312973acd7.jpg" style="zoom:67%;" />

<ul>
<li>Satisfy ME1, ME2 and ME3.</li>
<li>Protocol: to enter CS is associated with possession of a token.</li>
<li>Example: consider three processes p1, p2 and p3.<ul>
<li>p3 is not interested in the token.</li>
<li>p1 and p2 request it concurrently.</li>
<li>Timestamps of p1’ and p2’s requests are 41 and 34 respectively.</li>
<li>p3 replies all requests. p2 does not reply p1’s request since its timestamp is lower while p1 does.</li>
</ul>
</li>
</ul>
<h5 id="5-2-2-DME-Ring-based-Algorithm"><a href="#5-2-2-DME-Ring-based-Algorithm" class="headerlink" title="5.2.2 DME: Ring-based Algorithm"></a>5.2.2 DME: Ring-based Algorithm</h5><ul>
<li>One of the simple algorithm is to arrange the n processes into a logical ring.</li>
<li>There is a logical token circulate on the ring (say in clockwise direction).</li>
<li>If a process does not need to enter CS, it immediately forwards the token to its neighbor.</li>
</ul>
<img src="https://pic.imgdb.cn/item/62879bea0947543129741a70.jpg" style="zoom:67%;" />

<ul>
<li>A process wishes to enter the CS waits until it holds the token and retains it. </li>
<li>To leave the CS, the process releases the token to its neighbour. </li>
<li>If a process holding the token fails, an election is required to pick a unique process from the surviving members which regenerate the token and transmit it as before.</li>
<li>Care must be taken if the process is really failed. Two tokens may circulate on the ring!</li>
</ul>
<h5 id="5-2-3-Exercise"><a href="#5-2-3-Exercise" class="headerlink" title="5.2.3 Exercise"></a>5.2.3 Exercise</h5><p><strong>Discuss and compare the performance characteristics of two distributed mutual exclusion algorithms,</strong> </p>
<p><strong>(i) the central server algorithm</strong> </p>
<p><strong>(ii) the Ricard and Agrawala’s algorithm,</strong> </p>
<p><strong>in terms of message overheads, response time of requests, and reliability.</strong></p>
<img src="https://pic.imgdb.cn/item/62879ca40947543129747a28.jpg" style="zoom: 80%;" />



<p><strong>Message overheads</strong></p>
<p>For each token request:</p>
<ul>
<li>The central server algorithm: 3 messages (request, token, release)</li>
<li>The distributed algorithm: 2(N-1) messages.</li>
</ul>
<p>For N clients and all will access the CS</p>
<ul>
<li>The central server algorithm: 3N messages</li>
<li>The distributed algorithm: 2N(N-1) messages -&gt; 2N^2-2</li>
</ul>
<p><strong>Response Time:</strong></p>
<ul>
<li>In the central server algorithm, every token request from client requires two messages (request and grant). It waits for a round-trip message time to receive a reply from the server. </li>
<li>In the distributed algorithm using logical clocks, every token sends out (N-1) messages and waits for (N-1) replies. It waits for (N-1) servers.</li>
</ul>
<p>So, the response time of the central server algorithm is faster.</p>
<p><strong>Reliability:</strong></p>
<ul>
<li>The central server algorithm is more reliable since only the failure of the central server will make the system stop working.</li>
<li>For the distributed algorithm, any node failure will stop others from entering the critical section.</li>
</ul>
<h5 id="5-2-4-Exercise-2-quiz"><a href="#5-2-4-Exercise-2-quiz" class="headerlink" title="5.2.4 Exercise 2 (quiz)"></a>5.2.4 Exercise 2 (quiz)</h5><p><strong>The following system uses central server algorithm to achieve distributed mutual exclusion.</strong></p>
<img src="https://pic.imgdb.cn/item/6289ff7c0947543129042ce0.jpg" style="zoom:67%;" />

<p><strong>a. Which clock, real-time clock of server S or logical clocks in the system, should be used to order the requests in the Request Queue?  Briefly explain your answer.</strong></p>
<p>As the order of granting token is based on the request arrival time, the order is based on the real-time clock of server S.  Maintaining logical clocks in the system (S, P1, P2 and P3) do not have significant benefit in this case.</p>
<p><strong>b. Briefly suggest how the system recovers from the following situations (consider each situation independently):</strong></p>
<ul>
<li><p><strong>P2 is temporary disconnected from the network.</strong></p>
<p>Assume a timer is assigned to the token which define its validity.  If the process doesn’t release the token before time out, the server will regenerate a new token for the next request.  The work done by the invalid token should be undo.  </p>
<p>If the p2 is temporary disconnect from the system and reconnect to the network before time-out, it should have no effect on the system.</p>
<p>However, if p2 only reconnect after time-out, the update associated with the token must be undo.</p>
</li>
<li><p><strong>P2 is crashed and restarted immediately</strong></p>
<p>P2 probably will lost its memory after restart and new token should be generated after time out.  P2 should undo any operation associated with the lost token</p>
</li>
<li><p><strong>S is crashed</strong></p>
<p>The system can only be recovered after a new server is elected.</p>
</li>
</ul>
<h4 id="5-3-Distributed-Coordination-Election"><a href="#5-3-Distributed-Coordination-Election" class="headerlink" title="5.3 Distributed Coordination: Election"></a>5.3 Distributed Coordination: Election</h4><ul>
<li>A method to choose a unique process to play a particular role is called an election algorithm.</li>
<li>Main requirement is for the choice of elected process to be unique, even several processes call elections concurrently</li>
</ul>
<h5 id="Election-Bully-Algorithm"><a href="#Election-Bully-Algorithm" class="headerlink" title="Election: Bully Algorithm"></a>Election: Bully Algorithm</h5><ul>
<li><p>It can be used when the members of a group know the identities and addresses of the other members. </p>
</li>
<li><p>The algorithm selects the surviving member with the largest identity to be coordinator.</p>
</li>
<li><p>Assumption: communication is reliable but processes can fail during an election. </p>
</li>
<li><p>Three types of message:    </p>
<ul>
<li>election message - sent to announce an election, await for answer.</li>
<li>answer message - sent in response to an election message.</li>
<li>coordinator message - sent to announce the identity of the new coordinator.</li>
</ul>
</li>
<li><p>A process begins an election if it notices coordinator has failed.</p>
</li>
<li><p>The process that knows it has the highest identifier can elect itself as the coordinator simply by sending a coordinator message to all processes with lower identifiers. </p>
</li>
<li><p>Otherwise, a process can begin an election by sending an election message to those processes that have a higher identifier. </p>
</li>
<li><p>It then awaits an answer message in response. </p>
</li>
<li><p>If none arrives within a certain time, the process considers itself the coordinator, and sends a coordinator message to all processes with lower identifiers announcing this fact. </p>
</li>
<li><p>Otherwise (the process receives answer message(s)), the process waits a further limited period for a coordinator message to arrive from the new coordinator.</p>
</li>
<li><p>If none arrives, it begins another election.</p>
</li>
<li><p>If a process receives a coordinator message, it sets the identifier in the message as the new coordinator. </p>
</li>
<li><p>When an election message arrives to a node (with higher identifier), the node sends an answer and starts its own election (i.e. send election message to nodes with higher identifiers). </p>
</li>
<li><p>When the failed process is restarted, it begins election, if it has the highest identity, then it will decide it is coordinator, and announce this to other processes.</p>
</li>
<li><p>It becomes the coordinator even the current coordinator is functioning (so called bully).</p>
</li>
</ul>
<p>Stage 1: p1 detects the failure of the coordinator p4, so p1 and announces an election. (priority: p1&lt;p2&lt;p3)</p>
<img src="https://pic.imgdb.cn/item/6287a87609475431297a4cdc.jpg" style="zoom:80%;" />

<p>Stage 2: p2 and p3 send answer message to p1 and then begin their own elections.</p>
<img src="https://pic.imgdb.cn/item/6287a8a009475431297a6479.jpg" style="zoom:80%;" />

<p>Stage 3: Since p3 will receive no answer messages from p4 , it therefore decides it is the coordinator. But it fails before it sends out the coordinator message. Thus p1 timeouts. </p>
<img src="https://pic.imgdb.cn/item/6287a8c109475431297a75f4.jpg" style="zoom:80%;" />

<p>Stage 4: Since p1 notices the absence of a coordinator message and begins another election. This time p2 is elected coordinator.</p>
<img src="https://pic.imgdb.cn/item/6287a8dc09475431297a8720.jpg" style="zoom:80%;" />

<h5 id="Election-Ring-based-Election"><a href="#Election-Ring-based-Election" class="headerlink" title="Election: Ring-based Election"></a>Election: Ring-based Election</h5><ul>
<li>Assumption:<ul>
<li>processes are arranged in a logical ring</li>
<li>each process knows only how to communicate with its neighbor in, say, the clockwise direction. The process does not know the other processes.</li>
<li>All the processes remain functional and reachable</li>
</ul>
</li>
</ul>
<img src="C:\Users\win10\AppData\Roaming\Typora\typora-user-images\image-20220520224346234.png" alt="image-20220520224346234" style="zoom: 67%;" />

<img src="https://pic.imgdb.cn/item/6287a93c09475431297ab893.jpg" style="zoom: 67%;" />

<ul>
<li><p>Initially, every process is marked as a non-participant</p>
</li>
<li><p>Any process can begin an election by marking itself as a participant, placing its ID in an election msg and sending it to its neighbor.</p>
</li>
<li><p>When a process receives an election msg:</p>
<ul>
<li>if the arrived ID is greater, it forwards the msg to its neighbor</li>
<li>If the arrived ID is smaller and the process is not a participant then it substitutes its own ID in the msg and forwards it; but it does not forward the msg  if it is already a participant.</li>
</ul>
</li>
<li><p>On forwarding an election msg, the process marks itself as a participant</p>
</li>
<li><p><strong>If the received ID is that of the receiver itself, this process’s ID must be the greatest and it becomes the coordinator.</strong></p>
</li>
<li><p>The coordinator marks itself as a non-participant once more and sends an elected msg with its ID to its neighbour.</p>
</li>
<li><p>When a process other than the coordinator receives an elected msg, it marks itself as a non-participant and forwards the msg to its neighbor</p>
</li>
<li><p>Marking processes as participant or non-participant is to extinguish the concurrent election messages as soon as possible.</p>
</li>
<li><p>In the worst case, 3n-1 msg are needed to complete an election.</p>
</li>
</ul>
<p>**An Example with two concurrent tokens **</p>
<img src="https://pic.imgdb.cn/item/6287aaa609475431297b7b9a.jpg" style="zoom: 67%;" />

<h5 id="Exercise-3"><a href="#Exercise-3" class="headerlink" title="Exercise"></a>Exercise</h5><p><strong>In the ring-based election algorithm, the processes need to mark participant or non-participant in an election process.  Explain why.</strong></p>
<p>Ans: Two processes may start the election process at the same time leading to more than one election message.  The purpose of marking participant or non-participant is to extinguish the concurrent election message as soon as possible and always before the “winning” result has been announced.</p>
<h3 id="6-Replication"><a href="#6-Replication" class="headerlink" title="6. Replication"></a>6. Replication</h3><p>Replication is the maintenance of on-line copies of data and other resources.</p>
<img src="https://pic.imgdb.cn/item/6287abe809475431297c2cc7.jpg" style="zoom: 80%;" />

<p><strong>Motivation</strong></p>
<ul>
<li>Performance enhancement<ul>
<li>fast response time and increased throughput</li>
</ul>
</li>
<li>High availability <ul>
<li>clients can access an alternative server if the default server fails or becomes unreachable</li>
</ul>
</li>
<li>Fault tolerance<ul>
<li>provide guarantees of correct request processing even though one of the servers in a group fails</li>
</ul>
</li>
</ul>
<p><strong>Replication: Requirement</strong></p>
<ul>
<li>Replication transparency<ul>
<li>clients should not be aware that multiple physical copies of data exist.</li>
</ul>
</li>
<li>Consistency transparency<ul>
<li>unacceptable for different clients to obtain differing results</li>
<li>dealt with how to apply updates to different replica</li>
</ul>
</li>
</ul>
<p><strong>Ordering Models: Asynchronous</strong></p>
<ul>
<li>All client requests are processed by the local replica server</li>
<li>The local replica servers communicate updates to all other replica servers. Servers process updates as they arrive</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287ac9109475431297c8b7f.jpg" style="zoom:67%;" />

<p><strong>Ordering Models: Totally Synchronous</strong></p>
<ul>
<li>All update requests are totally ordered. That is, requests are processed at all replicas in the same order.</li>
<li>A next request can be processed only after the previous update has been processed at all servers</li>
<li>Poor performance in response time and throughput</li>
<li>Scheme in between: Quorum-based Schemes (Min. vote for a decision&#x2F;event) and causality</li>
</ul>
<p><strong>Ordering Models</strong></p>
<img src="https://pic.imgdb.cn/item/6287ad9709475431297d1391.jpg" style="zoom:67%;" />

<h4 id="6-1-Basic-Architectural-Model"><a href="#6-1-Basic-Architectural-Model" class="headerlink" title="6.1 Basic Architectural Model"></a>6.1 Basic Architectural Model</h4><p>Three entities:</p>
<ul>
<li>Replica manager: maintains a physical copy of every logical data item</li>
<li>Client: makes a series of requests.</li>
<li>Front end: handles the requests of clients<ul>
<li>to communicate with replica managers  for clients’ requests</li>
</ul>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287adeb09475431297d380b.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/6287ae1509475431297d55eb.jpg" style="zoom:67%;" />

<h4 id="6-2-Ordering"><a href="#6-2-Ordering" class="headerlink" title="6.2 Ordering"></a>6.2 Ordering</h4><p>Total ordering</p>
<ul>
<li>If r1 and r2 are requests, then either r1 is processed before r2 at all replica managers or r2 is processed before r1 at all replica managers.</li>
</ul>
<p>Causal ordering</p>
<ul>
<li>If r1 and r2 are requests and r1 happened-before r2, then r1 is processed before r2 at all replica managers</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287ae8609475431297db1de.jpg" style="zoom:67%;" />

<p><strong>Implementation Techniques for Ordering</strong></p>
<ul>
<li>Hold-Back: a received request is not processed by a replica manager until ordering constraints can be met.</li>
<li>E.g. a bulletin board item Re:Microkernels may be held back until an item concerning Microkernels has already appeared.</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287b1630947543129801292.jpg" style="zoom:67%;" />

<p><strong>Implementing Total Ordering</strong></p>
<ul>
<li>Basic approach: assigns totally ordered identifiers to requests so that each RM (replica manager) site makes the same ordering decision based on these identifiers</li>
<li>Simple technique: use a process called sequencer to assign identifiers</li>
<li>All requests are sent to the sequencer as well as to the RM sites</li>
<li>The sequencer assigns consecutive increasing identifiers to requests and forwards them to the RM sites</li>
<li>Requests arriving at an RM site are held back until they are next in sequence.</li>
</ul>
<h4 id="6-3-Another-Algorithm-for-Total-Ordering"><a href="#6-3-Another-Algorithm-for-Total-Ordering" class="headerlink" title="6.3 Another Algorithm for Total Ordering"></a>6.3 Another Algorithm for Total Ordering</h4><ul>
<li>RM sites propose identifiers for requests to the corresponding FE (front end) sites as they arrive</li>
<li>The FE site use them to generate final identifiers</li>
<li>Each RM sites have:<ul>
<li>Fmax: the largest final identifier agreed so far</li>
<li>Pmax: its own largest proposed identifier</li>
</ul>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287b22709475431298090fb.jpg" style="zoom:80%;" />

<ul>
<li><p>The FE site sends the request bearing a temporary identifier (larger than previously-used ones (F)) to all RM sites</p>
</li>
<li><p>Each RM at site i replies the proposed identifier (P)</p>
</li>
<li><p>Max(Fmax,Pmax) +1 + i&#x2F;N</p>
<ul>
<li>where N is the number of RM sites</li>
</ul>
</li>
<li><p>Each RM places the request on its hold-back queue which is ordered with the smallest request identifier</p>
</li>
<li><p>The FE site selects the largest proposed identifiers as the next agreed identifier.</p>
</li>
<li><p>The term i&#x2F;N makes the selected identifier unique</p>
</li>
<li><p>The FE site then notifies all the RM sites of the final identifier (Agreed ID)</p>
</li>
<li><p>The RM sites attach the final identifier to the request and re-order the request on the hold-back queue. Note that the final identifier may differ from the proposed identifier.</p>
</li>
<li><p>When the request at the front of the hold-back queue has been assigned its final identifier, it is transferred to the tail of the delivery queue.</p>
</li>
</ul>
<p>Advantages:</p>
<ul>
<li>straightforward to implement</li>
<li>no bottleneck or single point of failure</li>
</ul>
<p><strong>Implementing Causal Ordering</strong></p>
<ul>
<li>A bulletin board system with several replica as an example</li>
<li>Assumptions:<ul>
<li>bulletin board items are never removed</li>
<li>it is updated only by the addition of new items</li>
</ul>
</li>
<li>Vector Clock</li>
</ul>
<h4 id="6-4-Deadlocks"><a href="#6-4-Deadlocks" class="headerlink" title="6.4 Deadlocks"></a>6.4 Deadlocks</h4><ul>
<li>The use of locks (for exclusive use) can lead to deadlock.</li>
<li>Deadlock is a state in which each member of a group of transactions is waiting for some other member to release a lock.</li>
<li>A wait-for graph can be used to capture this waiting relationship.</li>
<li>A directed edge is added from node T to node U if transaction T is waiting for transaction U to release a lock.</li>
<li>As each transaction can wait for only one data item, the wait-for graph can be simplified to contain transactions only.</li>
</ul>
<p><strong>Deadlock with Read and Write Locks</strong></p>
<img src="https://pic.imgdb.cn/item/6287b400094754312981bc78.jpg" style="zoom: 67%;" />

<img src="https://pic.imgdb.cn/item/6287b45b09475431298203a7.jpg" style="zoom: 67%;" />

<img src="https://pic.imgdb.cn/item/6287b47609475431298216d9.jpg" style="zoom:67%;" />

<h5 id="Deadlock-Resolution"><a href="#Deadlock-Resolution" class="headerlink" title="Deadlock Resolution"></a>Deadlock Resolution</h5><ul>
<li>Deadlock prevention<ul>
<li>a transaction needs to get all locks when it starts</li>
<li>a transaction requests locks in a predefined order</li>
</ul>
</li>
<li>Deadlock detection<ul>
<li>find cycles in the wait-for graph and break the cycle</li>
<li>the choice of the transaction to abort is not simple</li>
</ul>
</li>
<li>Timeouts<ul>
<li>commonly used</li>
<li>the transaction is aborted to release the lock after timeout if there is another requesting transaction.</li>
</ul>
</li>
</ul>
<h5 id="Distributed-Deadlock"><a href="#Distributed-Deadlock" class="headerlink" title="Distributed Deadlock"></a>Distributed Deadlock</h5><ul>
<li>Detection of a distributed deadlock requires a global wait-for cycle to be found.</li>
<li>A simple solution: one server is dedicated to detect global deadlocks periodically<ul>
<li>combine local wait-for graphs to check for cycles</li>
<li>disadvantages: single point of failure, lack of fault tolerance and no ability to scale.</li>
<li>How often to detect deadlocks?</li>
</ul>
</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287b5b1094754312982f619.jpg" style="zoom: 67%;" />

<img src="https://pic.imgdb.cn/item/6287b5c709475431298304a2.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/6287b6a60947543129839121.jpg" style="zoom:67%;" />

<h5 id="Phantom-Deadlocks"><a href="#Phantom-Deadlocks" class="headerlink" title="Phantom Deadlocks"></a>Phantom Deadlocks</h5><ul>
<li>A deadlock is “detected” but is not really a deadlock</li>
<li>Phantom deadlocks occur due to the transmission delay of wait-for information</li>
<li>In the course of detection, a transaction that holds a lock will meanwhile have released.</li>
<li>If transactions are using two-phase locks, can phantom deadlock occur?</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287b727094754312983e247.jpg" style="zoom:80%;" />

<h5 id="Edge-Chasing"><a href="#Edge-Chasing" class="headerlink" title="Edge Chasing"></a>Edge Chasing</h5><ul>
<li>Also called path pushing</li>
<li>The global wait-for graph is not constructed.</li>
<li>Instead, the servers forward messages called Probes that follow the edges of the wait-for graph.</li>
<li>A probe message consists of transaction wait-for relationships representing a path in the global wait-for graph.</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287ba49094754312985c645.jpg" style="zoom:80%;" />

<ul>
<li>Initiation<ul>
<li>When a transaction T starts waiting for another transaction U which is waiting to access a data item at another server, the edge &lt;T-&gt;U&gt; is sent to the server of the data item where U is blocked.</li>
</ul>
</li>
<li>Detection<ul>
<li>On receiving probes, the server adds paths to the probes</li>
<li>If no cycle and a transaction is waiting for a data item at another server, probes are sent to the server.</li>
</ul>
</li>
<li>Resolution<ul>
<li>When deadlock is detected, a transaction is selected to abort.</li>
</ul>
</li>
</ul>
<h5 id="More-Than-One-Transaction-Aborted"><a href="#More-Than-One-Transaction-Aborted" class="headerlink" title="More Than One Transaction Aborted"></a>More Than One Transaction Aborted</h5><ul>
<li>Every transaction involved in a deadlock cycle can initiate the deadlock detection</li>
<li>This concurrent detection may lead to the abortions of more than one transaction</li>
<li>To solve it, transactions are given totally-ordered priorities.</li>
<li>The transaction with the lowest priority is aborted to break the deadlock</li>
</ul>
<h4 id="6-5-Exercise"><a href="#6-5-Exercise" class="headerlink" title="6.5 Exercise"></a>6.5 Exercise</h4><p><strong>A front end has vector timestamp (3,5,7) representing the data it has received from members of a group of three replica managers. The three replica managers have vector timestamps (5,2,8), (4,5,6) and (4,5,8), respectively. Which replica manager(s) could immediately satisfy a query from the front end, and what is the resultant time stamp of the front end? Which replica manager could incorporate an update from the front end immediately?</strong></p>
<p>Ans: The replica manager with the timestamp (4,5,8) can satisfy the query because the others have not yet processed at least one update seen by the front end.  The resulting timestamp of the front end will be (4,5,8). The replica manager with the timestamp (4,5,8) could incorporate the update.</p>
<h3 id="7-Distributed-File-Service"><a href="#7-Distributed-File-Service" class="headerlink" title="7. Distributed File Service"></a>7. Distributed File Service</h3><h4 id="7-1-Conventional-File-System"><a href="#7-1-Conventional-File-System" class="headerlink" title="7.1 Conventional File System"></a>7.1 Conventional File System</h4><ul>
<li>Responsible for the organization, storage, retrieval, naming, sharing and protection of files</li>
<li>Provides a set of programming operations that characterize the file abstraction</li>
<li>Design to store and manage large numbers of files, with facilities for creating, naming and deleting the files;</li>
<li>Control the access to files</li>
</ul>
<h4 id="7-2-Distributed-File-System"><a href="#7-2-Distributed-File-System" class="headerlink" title="7.2 Distributed File System"></a>7.2 Distributed File System</h4><ul>
<li>An essential component in distributed systems</li>
<li>Use to support the sharing of persistent storage and its information</li>
<li>Enable user programs to access remote files without copying them to a local disk</li>
<li>Provide access to files from diskless nodes</li>
<li>The most heavily-used services →its functionality and performance are critical</li>
</ul>
<h4 id="7-3-Design-Issues"><a href="#7-3-Design-Issues" class="headerlink" title="7.3 Design Issues"></a>7.3 Design Issues</h4><p>The features that are partially or wholly addressed by most current file services:</p>
<ul>
<li><p>Access transparency</p>
<ul>
<li>Client programs should be unaware of the distribution of files. </li>
<li>A single set of operations is provided for access to local and remote files. </li>
<li>Programs written to operate on local files are able to access remote files without modification.</li>
</ul>
</li>
<li><p>Location transparency</p>
<ul>
<li>Client programs should see a uniform file name space.</li>
<li>File or groups of files may be relocated without changing their names. </li>
<li>User programs see the same name space wherever they are executed.</li>
</ul>
</li>
<li><p>Concurrency transparency</p>
<ul>
<li>Changes to a file by one client should not interfere with the operation of other clients simultaneously accessing the same file.</li>
</ul>
</li>
<li><p>Failure transparency</p>
<ul>
<li>Correct operation of servers after failure of a client;</li>
<li>Correct operation of client programs in the face of lost message and temporary interruptions of the service.</li>
</ul>
</li>
<li><p>Performance transparency</p>
<ul>
<li>Client programs should continue to perform satisfactorily while the load on the file service varies within a specified a range.</li>
</ul>
</li>
<li><p>Scaling transparency</p>
<ul>
<li>The service can be extended by incremental growth to deal with a wide range of loads and system sizes.</li>
</ul>
</li>
<li><p>Replication transparency (for very large DS)</p>
<ul>
<li>A file may be represented by several copies of its contents at different locations. </li>
<li>It enables multiple servers to share the load of providing a service to many clients, enhancing the performance and scalability of service,</li>
<li>It enhances fault tolerance by enabling a client to locate another server that holds a copy of the file on the server that has just failed.</li>
</ul>
</li>
<li><p>Migration transparency (for very large DS)</p>
<ul>
<li>Neither client programs nor system administration tables in client nodes need to be changed when files are moved. </li>
<li>This allows file mobility - files, sets or volumes of files may be moved, either by system administrators or automatically.</li>
</ul>
</li>
<li><p>Hardware and operating system heterogeneity</p>
<ul>
<li>The service interfaces should be defined so that client and server software can be implemented for different OS and computers (for openness).</li>
</ul>
</li>
<li><p>The features that are not found in current file services but important in the future:</p>
<ul>
<li>Support for fine-grained distributed of data<ul>
<li>As the sophistication of distributed application grows, the sharing of data in small units will become necessary.</li>
<li>We need to locate individual objects near the processes that are using them and to cache them individually in those locations.</li>
</ul>
</li>
<li>Tolerance to network partitioning and detached operation<ul>
<li>When a file service includes the replication or caching of files, clients may be affected when a network partition occurs.</li>
<li>We need to handle the inconsistent database once a network partition occurs.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="7-4-File-Service-Components"><a href="#7-4-File-Service-Components" class="headerlink" title="7.4 File Service Components"></a>7.4 File Service Components</h4><img src="https://pic.imgdb.cn/item/6287c39c09475431298c0a9f.jpg" style="zoom: 67%;" />

<ul>
<li>Flat file service<ul>
<li>This service is concerned with implementing operations on the contents of files. </li>
<li>Unique file identifiers (UFIDs) are used to refer to files in all requests for flat file service operations.    (construction of UFID will be discussed later)</li>
</ul>
</li>
<li>Directory service<ul>
<li>provide a mapping between text names for files and their UFIDs. (UNIX uses hierarchic file name)</li>
</ul>
</li>
<li>Client module<ul>
<li>A single client module runs in each client computer</li>
<li>It integrates and extends operations of flat file service and directory service under a single application programming interface</li>
<li>The interface is available to user-level programs in client computers</li>
</ul>
</li>
</ul>
<h4 id="7-5-Interface-Flat-File-Service"><a href="#7-5-Interface-Flat-File-Service" class="headerlink" title="7.5 Interface (Flat File Service)"></a>7.5 Interface (Flat File Service)</h4><ul>
<li>RPC interface used by client modules</li>
<li>Not normally used directly by user-level programs</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287c49d09475431298cad2f.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/6287c4b909475431298cc07b.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/6287c4d209475431298cd21b.jpg" style="zoom:67%;" />

<h4 id="7-6-Interface-Directory-Service"><a href="#7-6-Interface-Directory-Service" class="headerlink" title="7.6 Interface (Directory Service)"></a>7.6 Interface (Directory Service)</h4><p>To provide a service for translating text names to UFIDs.</p>
<img src="https://pic.imgdb.cn/item/6287c70a09475431298e335a.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/6287c72409475431298e426c.jpg" style="zoom:67%;" />



<p><strong>Designed for fault tolerance</strong>:</p>
<ul>
<li>Repeatable operations: with the exception of create, the operations are idempotent. (repeated execution of create causes a space leak.)</li>
<li>Stateless servers: can be restarted after a failure and resume operation without need for clients or other server to restore any state.</li>
</ul>
<h4 id="7-7-Case-Studies-NFS"><a href="#7-7-Case-Studies-NFS" class="headerlink" title="7.7 Case Studies: NFS"></a>7.7 Case Studies: NFS</h4><ul>
<li><p>Network File System (NFS) is a distributed file system protocol originally developed by Sun Microsystems (Sun) in 1984, allowing a user on a client computer to access files over a computer network much like local storage is accessed. </p>
</li>
<li><p>Design goals:</p>
<ul>
<li>Emulation of the UNIX file system interface</li>
<li>Concurrent access</li>
<li>One-copy update semantics<ul>
<li>The file contents seen by all of the processes accessing or updating a given file are those that they would see if only single copy of the file contents existed.</li>
</ul>
</li>
</ul>
</li>
<li><p>Architecture</p>
<ul>
<li>The basic idea of NFS is to allow an arbitrary collection of clients and servers to share a common file system.</li>
<li>Each NFS server exports one or more of its directories for access by remote clients.</li>
</ul>
</li>
<li><p>The list of directories a server exports is maintained in the &#x2F;etc&#x2F;exports file, so these directories can be exported automatically whenever the server is booted. (migration transparency) </p>
</li>
<li><p>Clients access exported directories by mounting them.</p>
</li>
<li><p>When a client mounts a (remote) directory, it becomes part of its directory hierarchy. (location transparency)</p>
</li>
<li><p>Local and remote file systems accessible on an NFS client.</p>
<img src="https://pic.imgdb.cn/item/6287c83b09475431298ee785.jpg" style="zoom:67%;" />
</li>
<li><p>To access a file, there is (almost) no difference between a file located on a remote file server and a file located on the local disk. (performance transparency)</p>
</li>
<li><p>Once the mounts have been done, nothing special has to be done to achieve sharing. (access transparency)</p>
</li>
<li><p>If two or more clients mount the same directory at the same time, they can communicate by sharing files in their common directories.</p>
</li>
<li><p>The NFS service is stateless and most of the operations of the file access protocol are idempotent. (failure transparency)</p>
</li>
<li><p>It does not support replication transparency because it is a separate service.</p>
</li>
<li><p>It does not support concurrency transparency because it does not aim to improve upon the UNIX approach to the control of concurrent updates of files.</p>
<ul>
<li>NFS 4.0 has been extended to support.</li>
</ul>
</li>
<li><p>It is not scalability: maximum 50 clients, usually 5 - 10 clients.</p>
</li>
</ul>
<p>File Service Components</p>
<img src="https://pic.imgdb.cn/item/6287c8bc09475431298f2f7d.jpg" style="zoom:67%;" />



<ul>
<li><p>Virtual File System (VFS)</p>
<ul>
<li>Distinguish local and remote files;</li>
<li>Translate between UNIX-independent File Identifiers (FIDs) used by NFS and the internal file identifiers normally used in UNIX and other file systems.</li>
<li>UFID used by NFS is called file handle.</li>
<li>It is opaque (not observed) to users.</li>
<li>Filesystem identifier: a unique number that is allocated to each file system when it is created.</li>
</ul>
</li>
<li><p>NFS communication</p>
<ul>
<li>Port mapper enables Clients to bind to a service in a given host by name.</li>
<li>Clients use RPC to access Server interfaces.</li>
<li>NFS RPC interface is open.</li>
<li>Any authenticated request will be executed.</li>
<li>NFS handles the requests according to the UFIDs. (operations are similar to Read, Write, … in Flat file Service)</li>
</ul>
</li>
<li><p>i-node number: a number that serves to identify and locate the file within the file system in which the file is stored.</p>
</li>
<li><p>i-node generation number: increment each time the i-node number is reused).</p>
</li>
<li><p>file handle is made unique with i-node generation number.</p>
</li>
</ul>
<p>The format of UNIX-Independent File Identifiers (FIDs) used by NFS:</p>
<img src="https://pic.imgdb.cn/item/6287d16509475431299408a1.jpg" style="zoom: 80%;" />

<ul>
<li><p>NFS Client module</p>
<ul>
<li>Simulate UNIX standard file service;</li>
<li>Integrated with UNIX kernel;</li>
<li>Users can access files via system calls;</li>
<li>Single client module serves all user level processes (in a client machine) with shared cache.</li>
<li>Path name translation to file handle.</li>
</ul>
</li>
<li><p>NFS server module</p>
<ul>
<li>Integrated with UNIX kernel for performance, including access control and authentication.</li>
<li>E.g. Sun RPC requires client to present their User_Id &amp; Group_Id (in each RPC call), NFS server checks against access permission in file attribute.</li>
</ul>
</li>
<li><p>Mount service</p>
<ul>
<li>Mount requests are performed as a part of system initialization process. Client user process uses mount system call for further mounting when necessary.</li>
<li>Mount server uses an RPC interface, mount requests contains the pathname of a directory (to be mounted) and returns the file handle of the directory.</li>
</ul>
</li>
<li><p>Two kinds of mount services for remote file system: hard mounted or soft mounted;</p>
</li>
<li><p>Hard mounted (“try hard”): User process is suspended until request completed; If not completed (unavailable), client module retries until success. </p>
</li>
<li><p>Soft mounted (“do not try hard”): NFS client module returns a failure notification to user process after a few time-out retries. User process should handle the failure.</p>
</li>
<li><p>Most applications take hard mount (why?)</p>
</li>
<li><p>Automounter</p>
<ul>
<li>Dynamically mount a file system if “empty” mount point is referenced.The file system on the first server to respond is mounted at the client using the normal mount service.</li>
</ul>
</li>
<li><p><strong>Client caching</strong></p>
<ul>
<li>NFS client module caches results of: read, write, get-attribute, lookup and read-dir.</li>
<li>Consistency problem: Writing by a client does not result in the immediate updating of cached copies in other clients.</li>
</ul>
</li>
<li><p><strong>Server Caching</strong></p>
<ul>
<li>Enhance the performance NFS;</li>
<li>UNIX server cache<ul>
<li>File pages, directories and file attributes read from disk are retained in buffer cache.</li>
<li>Delayed-write: when a page has been altered, its page is written in disk only when the page is needed.</li>
<li>To prevent loss data, UNIX flushes altered page every 30 sec.</li>
</ul>
</li>
<li>NFS Server cache<ul>
<li>Read cache is the same as UNIX;</li>
<li>NFS flushes altered page immediately. Otherwise, clients (sharing a file) may lose some updates.</li>
</ul>
</li>
</ul>
</li>
<li><p>Solution 1: Timestamp (read)</p>
<ul>
<li>Each cache entry is associated with a Timestamp.     </li>
<li>A client requests last modification time from server;</li>
<li>Compares the time with its cache Timestamp; </li>
<li>If (time &gt; Timestamp) (time is more recent) then the cache blocks of the file are invalidated and must be re-fetched.</li>
</ul>
</li>
<li><p>Solution 2: Validation check (read)</p>
<ul>
<li>3 sec. for files &amp; 30 sec. for directories. </li>
<li>Files have vulnerability window of 3 sec. </li>
<li>Seems to be tolerable for most applications.</li>
</ul>
</li>
<li><p>Solution 3: Bio-demon( Block I&#x2F;O manager process) implemented by NFS client.</p>
<ul>
<li>Read-Ahead: a bio-demon is notified after each read request and it requests the transfer of the following file block from the server to the client cache.</li>
<li>Delayed-write: a block is sent to server if the block is filled.</li>
<li>Directory blocks are sent whenever a modification has occurred.</li>
</ul>
</li>
</ul>
<h4 id="7-8-Case-study-2-Apache-Hadoop"><a href="#7-8-Case-study-2-Apache-Hadoop" class="headerlink" title="7.8 Case study 2: Apache Hadoop"></a>7.8 Case study 2: Apache Hadoop</h4><ul>
<li>Apache Hadoop is a collection of open-source software utilities that facilitates using a network of many computers to solve problems involving massive amounts of data and computation. </li>
<li>It provides a software framework for distributed storage and processing of big data using the MapReduce programming model.</li>
<li>Hadoop File System was developed using distributed file system design. </li>
<li>It is fault-tolerant and designed using low-cost hardware.</li>
<li>To store such huge data, the files are stored across multiple machines. These files are stored in redundant fashion to rescue the system from possible data losses in case of failure.</li>
</ul>
<p><strong>Features of HDFS</strong></p>
<ul>
<li>It is suitable for the distributed storage and processing.</li>
<li>Hadoop provides a command interface to interact with HDFS.</li>
<li>The built-in servers of namenode and datanode help users to easily check the status of cluster.</li>
<li>Streaming access to file system data.</li>
<li>HDFS provides file permissions and authentication.</li>
</ul>
<img src="https://pic.imgdb.cn/item/6287db3f0947543129990545.jpg" style="zoom:67%;" />

<p><strong>Namenode</strong></p>
<ul>
<li>The namenode is the commodity hardware that contains the GNU&#x2F;Linux operating system and the namenode software.  </li>
<li>The namenode acts as the master server and it does the following tasks.</li>
<li>Manages the file system namespace.</li>
<li>Regulates client’s access to files.</li>
<li>It also executes file system operations such as renaming, closing, and opening files and directories.</li>
</ul>
<p><strong>Datanode</strong></p>
<ul>
<li>The datanode is a commodity hardware having the GNU&#x2F;Linux operating system and datanode software. For every node (Commodity hardware&#x2F;System) in a cluster, there will be a datanode. </li>
<li>These nodes manage the data storage of their system.</li>
<li>Datanodes perform read-write operations on the file systems, as per client request.</li>
<li>They also perform operations such as block creation, deletion, and replication according to the instructions of the namenode.</li>
</ul>
<p><strong>File Block</strong></p>
<ul>
<li>The file in HDFS will be divided into one or more segments and stored in individual data nodes. </li>
<li>These file segments are called as blocks. </li>
<li>In other words, the minimum amount of data that HDFS can read or write is called a Block. </li>
<li>The default block size is 64MB, but it can be increased as per the need to change in HDFS configuration.</li>
</ul>
<p><strong>Goals of HDFS</strong></p>
<ul>
<li><strong>Fault detection and recovery</strong> − Since HDFS includes a large number of commodity hardware, failure of components is frequent. Therefore HDFS should have mechanisms for quick and automatic fault detection and recovery.</li>
<li><strong>Huge datasets</strong> − HDFS should have hundreds of nodes per cluster to manage the applications having huge datasets.</li>
<li><strong>Hardware at data</strong> − A requested task can be done efficiently, when the computation takes place near the data. Especially where huge datasets are involved, it reduces the network traffic and increases the throughput.</li>
</ul>
<h4 id="7-8-Exercises"><a href="#7-8-Exercises" class="headerlink" title="7.8 Exercises"></a>7.8 Exercises</h4><p><strong>In-Class Exercise 1</strong></p>
<ul>
<li><p><strong>What kind transparency a DFS should be support? Which transparency is&#x2F;are required by large distributed system only?  Why?</strong></p>
</li>
<li><p><strong>Can you discuss how HDFS support any of the above transparency?</strong></p>
<p>Access Transparency</p>
<p>Location Transparency</p>
<p>Concurrency Transparency</p>
<p>Failure Transparency</p>
<p>Performance Transparency</p>
<p>Scaling Transparency</p>
<p>Replication Transparency</p>
<p>Migration Transparency</p>
</li>
</ul>
<p><strong>Revision Exercise 2</strong></p>
<p><strong>Consider the following diagram of NFS</strong></p>
<img src="https://pic.imgdb.cn/item/6287de3809475431299a7700.jpg" style="zoom:80%;" />

<ul>
<li><p><strong>What are the main functions of the Virtual file System and NFS Server?</strong></p>
<p>Virtual File System</p>
<ul>
<li>Distinguish local and remote files;</li>
<li>Translate between UNIX-independent File Identifiers (FIDs) used by NFS and the internal file identifiers normally used in UNIX and other file systems.</li>
</ul>
<p>NSF Server Module </p>
<ul>
<li>Integrated with UNIX kernel for performance, including access control and authentication</li>
</ul>
</li>
<li><p><strong>Which modules in the diagram may enhance by caching? Briefly explain your answer</strong></p>
<p>NFS client caching and server caching.</p>
<p>Client caching</p>
<ul>
<li>NFS client module caches results of: read, write, get-attribute, lookup and read-dir.</li>
<li>Consistency problem: Writing by a client does not result in the immediate updating of cached copies in other clients.</li>
</ul>
<p>Server Caching</p>
<p>……….see 7.7</p>
</li>
</ul>
<h3 id="8-Blockchain-and-Digital-Cash"><a href="#8-Blockchain-and-Digital-Cash" class="headerlink" title="8. Blockchain and Digital Cash"></a>8. Blockchain and Digital Cash</h3><h4 id="8-1-Fault-Tolerance"><a href="#8-1-Fault-Tolerance" class="headerlink" title="8.1 Fault Tolerance"></a>8.1 Fault Tolerance</h4><ul>
<li>Replication</li>
<li>Consistency among replicas is maintained by consensus algorithms</li>
<li>State machine replication: E.g. blockchain</li>
<li>Type of Fault<ul>
<li>Node is down</li>
<li>Node is performing malicious &#x2F; inconsistent behavior</li>
</ul>
</li>
</ul>
<h4 id="8-2-Consensus-Mechanisms"><a href="#8-2-Consensus-Mechanisms" class="headerlink" title="8.2 Consensus Mechanisms"></a>8.2 Consensus Mechanisms</h4><p><strong>Requirements</strong></p>
<ul>
<li><p>Agreement: All honest nodes decide on the same value</p>
</li>
<li><p>Termination: All honest nodes terminate execution of the consensus process and eventually reach a decision</p>
</li>
<li><p>Validity: The final agreed value must be the one proposed by at least one honest node</p>
</li>
<li><p>Fault tolerant: Allow the presence of faulty or malicious node (Byzantine node)</p>
</li>
<li><p>Byzantine fault tolerance-based</p>
<ul>
<li>Nodes publishing signed message</li>
<li>Agreement is reached when a certain number of messages are received</li>
</ul>
</li>
<li><p>Leader-based consensus mechanisms</p>
<ul>
<li>By competition</li>
<li>Winning node propose the final value</li>
</ul>
</li>
</ul>
<h4 id="8-3-CAP-Theorem"><a href="#8-3-CAP-Theorem" class="headerlink" title="8.3 CAP Theorem"></a>8.3 CAP Theorem</h4><ul>
<li>“Any distributed system cannot have <strong>Consistency, Availability, and Partition tolerance</strong> simultaneously”</li>
<li>Consistency: all nodes have the same latest copy of data </li>
<li>Availability: the system is up and running, able to serve client without failure</li>
<li>Partition tolerance:  The system is still operating correctly even group of nodes are down</li>
</ul>
<h4 id="8-4-Hashcash"><a href="#8-4-Hashcash" class="headerlink" title="8.4 Hashcash"></a>8.4 Hashcash</h4><ul>
<li><p>Introduced by Adam back in 1997</p>
</li>
<li><p>Proof of work (PoW) for control email spam</p>
</li>
<li><p>Sender must compute a hash for sending an email (as a proof that they have spent a reasonable amount of computing resources)</p>
</li>
<li><p>Generating hashcash is a compute intensive process, but easy and quick to verify (by receiver)</p>
</li>
<li><p>Acceptable to normal user Cost too much to spammer</p>
</li>
<li><p>B-Money</p>
<ul>
<li>Introduced by Wei Dai in 1998</li>
<li>Creating money via solving computational puzzles such as hashcash</li>
<li>Each node maintains its own list of transactions</li>
</ul>
</li>
<li><p>BitGold</p>
<ul>
<li>Nick Szabo, 2005</li>
<li>Solving computational puzzles to mint digital currency</li>
</ul>
</li>
<li><p>Cryptographic currency</p>
<ul>
<li>2005, Hal Finney</li>
<li>B-money + hashcash puzzles</li>
</ul>
</li>
<li><p>No clear solution to resolve conflict between nodes, must be relied on a centralized trusted authority</p>
</li>
</ul>
<h4 id="8-5-Bitcoin"><a href="#8-5-Bitcoin" class="headerlink" title="8.5 Bitcoin"></a>8.5 Bitcoin</h4><img src="https://pic.imgdb.cn/item/628881fc0947543129ff2426.jpg" style="zoom: 50%;" />

<ul>
<li>2009</li>
<li>Achieved distributed consensus in a trustless network</li>
<li>Public key cryptography with hashcash as PoW</li>
<li>Provide secure, controlled, and decentralized method of minting digital currency</li>
<li>Blockchain &#x3D; Electronic cash scheme + distributed systems</li>
</ul>
<img src="https://pic.imgdb.cn/item/6288830d0947543129fff851.jpg" style="zoom:67%;" />

<h4 id="8-6-Blockchain"><a href="#8-6-Blockchain" class="headerlink" title="8.6 Blockchain"></a>8.6 Blockchain</h4><p><strong>Tires of Blockchain Technology</strong></p>
<ul>
<li>Blockchain 1.0<ul>
<li>Cryptocurrencies</li>
</ul>
</li>
<li>Blockchain 2.0<ul>
<li>Financial services and contracts</li>
</ul>
</li>
<li>Blockchain 3.0<ul>
<li>Other Applications used in general-purpose industries such as government, health, media</li>
</ul>
</li>
</ul>
<p><strong>What is Blockchain</strong></p>
<ul>
<li>Platform for peers to exchange values using transactions without central trusted arbitrator -&gt; Decentralized consensus mechanism</li>
<li>Cryptographically secure</li>
<li>Append-only</li>
<li>Immutable</li>
<li>Updateable only via consensus among peers</li>
<li>Decentralized consensus mechanism</li>
<li>Distributed shared ledger.  Transaction are ordered and grouped into blocks</li>
<li>Data structure.  Linked list with hash pointers pointed to the previous block</li>
</ul>
<img src="https://pic.imgdb.cn/item/62888434094754312900cc68.jpg" style="zoom:67%;" />

<p><strong>Quick Question</strong></p>
<ul>
<li>How to carry a “private” communication in an open network?</li>
<li>How to identify (and prove) who are you in an open network?</li>
</ul>
<p><strong>Secure key</strong></p>
<img src="https://pic.imgdb.cn/item/628884db0947543129013d22.jpg" style="zoom:67%;" />

<p><strong>Public and Private Key</strong></p>
<img src="https://pic.imgdb.cn/item/6288851f0947543129016b8c.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/628885390947543129018016.jpg" style="zoom:67%;" />

<p><strong>Protection Against Eavesdropping</strong></p>
<img src="https://pic.imgdb.cn/item/628886e4094754312902b569.jpg" style="zoom:67%;" />

<p><strong>Digtal signature</strong></p>
<img src="C:\Users\win10\AppData\Roaming\Typora\typora-user-images\image-20220521143029919.png" alt="image-20220521143029919" style="zoom:67%;" />

<p><strong>Hash function</strong></p>
<ul>
<li>Take a string with any length</li>
<li>Output a fixed length hash code</li>
<li>Small change in the string will give a totally different hash code</li>
</ul>
<img src="https://pic.imgdb.cn/item/6288874509475431290317c2.jpg" style="zoom:67%;" />

<p><strong>Blockchain</strong></p>
<img src="https://pic.imgdb.cn/item/62888861094754312903f715.jpg" style="zoom:67%;" />

<img src="https://pic.imgdb.cn/item/6288887509475431290406bd.jpg" style="zoom:67%;" />

<p>The nonce is the number that blockchain miners are solving for.</p>
<img src="https://pic.imgdb.cn/item/628889050947543129046c4c.jpg" style="zoom:67%;" />

<p><strong>Nonce</strong></p>
<p>随机数</p>
<ul>
<li>Nonce, or a “number only used once,” refers to the first number a blockchain miner needs to discover before solving for a block in the blockchain. </li>
<li>Once the mathematical computations are solved by the miner, they are gifted cryptocurrency for their time and skill. </li>
<li>Nonces are difficult to find and are considered a way to weed out the less talented crypto miners. </li>
<li>The world of crypto mining is challenging, and one often needs excellent computational power to even begin to try and solve the nonce.</li>
</ul>
<p><strong>Generic Element of Blockchain</strong></p>
<ul>
<li>Addresses<ul>
<li>Unique identifiers used in a transaction stored in blockchain</li>
<li>Contain sender and recipient information</li>
<li>Public key or derived from a public key</li>
<li>Can be reused (for the same user) or one-off</li>
</ul>
</li>
<li>Transaction<ul>
<li>Fundamental unit of a blockchain</li>
<li>Transfer of value from one address to another</li>
</ul>
</li>
<li>Blocks<ul>
<li>A block is composed of multiple transactionsIt also contains other elements, like previous block hash, timestamp, nonce</li>
</ul>
</li>
<li>Peer-to-peer network<ul>
<li>Network topology for peer to peer communication</li>
</ul>
</li>
<li>Scripting or programming language, Virtual machine<ul>
<li>Predefined sets of commands for nodes to transfer tokens</li>
</ul>
</li>
<li>Nodes<ul>
<li>Node in a blockchain network</li>
<li>Provide various functions depending on its role<ul>
<li>Propose and validate transaction</li>
<li>Mining to facilitate consensus and secure the blockchain</li>
</ul>
</li>
</ul>
</li>
<li>Smart contracts<ul>
<li>Program runs on top of the blockchain</li>
<li>Business logic to be executed when certain conditions are met.</li>
<li>These actions could include releasing funds to the appropriate parties, registering a vehicle, sending notifications, or issuing a ticket</li>
</ul>
</li>
</ul>
<p><strong>Blockchain: Features</strong></p>
<ul>
<li>Distributed consensus<ul>
<li>Achieve a single version of truth (agreed by all parties) without the need of a central authority</li>
</ul>
</li>
<li>Transaction verification<ul>
<li>Only transaction that fulfills the predetermined set of rules can be included in a block</li>
</ul>
</li>
<li>Platforms for smart contracts<ul>
<li>Execute business logic on behalf of the user </li>
<li>Not all blockchains support the execution of smart contract</li>
<li>Desirable feature</li>
</ul>
</li>
<li>Transferring value between peers</li>
<li>Generating cryptocurrency<ul>
<li>Reward to the miners who validate the transactions and secure the blockchain</li>
</ul>
</li>
<li>Smart property<ul>
<li>Allow someone claim the ownership of property in blockchain</li>
</ul>
</li>
<li>Immutability<ul>
<li>Transaction added onto the blockchain is immutable</li>
</ul>
</li>
</ul>
<p><strong>Accumulate Blocks</strong></p>
<ul>
<li>A node uses its private key to sign a transaction </li>
<li>The transaction is propagated to peers which validate the transaction based on the pre-set criteria.  (multiple peers are generally required)</li>
<li>After validation, transaction is added to a block.  The block will propagate onto the network (Transaction confirmed)</li>
<li>Next block links to the block created in (3).  Transaction is double confirmed when the newly added block is confirmed</li>
<li>Reconfirm the transaction whenever a new block is created.  </li>
<li>After six confirmations in the bitcoin network, the transaction is final</li>
</ul>
<p><strong>Benefit</strong></p>
<ul>
<li>Decentralization</li>
<li>Transparency and trust<ul>
<li>Blockchains are shared</li>
</ul>
</li>
<li>Immutability </li>
<li>It is extremely difficult to change the confirmed data back</li>
<li>High availability <ul>
<li>Involve thousands of nodes in a peer-to-peer network</li>
<li>Data is replicated and updated on each and every node</li>
</ul>
</li>
<li>Highly secure<ul>
<li>All transactions on a blockchain are cryptographically secured and provide integrity</li>
</ul>
</li>
</ul>
<p><strong>Challenges and Limitations</strong></p>
<ul>
<li>Scalability</li>
<li>Adaptability</li>
<li>Regulation</li>
<li>Relatively immature technology</li>
<li>Privacy</li>
</ul>
<p><strong>Decentralization and Blockchain</strong></p>
<ul>
<li>Central<ul>
<li>client-server system</li>
<li>Single authority controls the system</li>
</ul>
</li>
<li>Distributed<ul>
<li>Data and computation are distributed to multiple nodes in the network</li>
<li>Central authority control all nodes and governs processing</li>
</ul>
</li>
<li>Decentralized<ul>
<li>No authority exists</li>
<li>Nodes are not dependent on a single master node</li>
<li>Decentralized consensus</li>
</ul>
</li>
<li>Disintermediation<ul>
<li>In blockchain, everyone can add a transaction into a block, no intermediary is involved</li>
</ul>
</li>
<li>Through competition<ul>
<li>Instead of eliminating the intermediary, the system provides free choice of intermediary</li>
<li>E.g. Smart contract in blockchain</li>
</ul>
</li>
</ul>
<p><strong>Blockchain and Full Ecosystem Decentralization</strong></p>
<ul>
<li>Storage<ul>
<li>Blockchain is not designed to store large amounts of data, e.g. image</li>
<li>It aims to store simple transaction </li>
<li>One can use distributed hash tables (DHTs), originally come from peer-to-peer file sharing software, e.g. BitTorrent</li>
<li>Inter Planetary File System (IPFS), Juan Benet, a decentralized World Wide Web, using Kadamlia DHT and merkle DAG(Directed Acyclic Graph) to provide the storage and searching functionality.</li>
<li>Filecoin: pays incentives to nodes that store data using the BitSwap mechanism</li>
</ul>
</li>
<li>Communication<ul>
<li>Internet is decentralized by design</li>
<li>But in practical, central authority (e.g. ISP, email server provider) is in control</li>
<li>Some apps support communication in a peer-to-peer fashion without the Internet</li>
</ul>
</li>
<li>Computation<ul>
<li>With blockchain technology, e.g. Ethereum, one can send cryptocurrency to anyone for a small fee. </li>
<li>E.g. smart contracts with embedded business logic can run on the network</li>
</ul>
</li>
</ul>
<h4 id="8-7-Bitcoin-2"><a href="#8-7-Bitcoin-2" class="headerlink" title="8.7 Bitcoin(2)"></a>8.7 Bitcoin(2)</h4><p><strong>Bitcoin Transaction</strong></p>
<ul>
<li>Bitcoin transaction tells the network that the owner of some bitcoin value has authorized the transfer of that value to another owner</li>
<li>New owner sends the bitcoin by creating another similar transaction</li>
</ul>
<img src="https://pic.imgdb.cn/item/6288943709475431290c4b3c.jpg" style="zoom:67%;" />

<ul>
<li>Each transaction contains one or more “inputs” and “outputs”</li>
<li>Inputs: bitcoin account to be debited</li>
<li>Outputs: bitcoin account to be creditedInputs and outputs are in bitcoin address</li>
<li>Unspent bitcoin is output to original owner with same &#x2F; different bitcoin address</li>
<li>Transactions move value from transaction inputs to transaction outputs</li>
</ul>
<p><strong>Common Transaction Forms</strong></p>
<img src="https://pic.imgdb.cn/item/6288950509475431290ce7fc.jpg" style="zoom:67%;" />

<p><strong>Transaction input</strong></p>
<ul>
<li>Full-node client <ul>
<li>Contains a copy of every unspent output from every transaction in the blockchain</li>
<li>Able to construct transaction inputs</li>
<li>Quickly verify incoming transaction (having correct inputs) </li>
<li>Requires a lot of disk space</li>
</ul>
</li>
<li>Lightweight client<ul>
<li>May track only the user’s own unspent outputs</li>
</ul>
</li>
<li>Wallet application without unspent transaction output<ul>
<li>Needs to query the bitcoin network or asking a full-node to retrieve unspent transaction output</li>
</ul>
</li>
</ul>
<p><strong>Transaction Output</strong></p>
<ul>
<li>Script that creates a claim on the value and can only be redeemed by the introduction of a solution to the script</li>
<li>E.g. A transaction output will contain a script that says something like “This output is payable to whoever can present a signature from the key corresponding to “B” public address”</li>
<li>Since only B’s wallet has the signature, B can present the signature and redeem the output</li>
<li>Transaction fee is outputted to miner for validating and including the transaction in a block to be recorded on the blockchain</li>
</ul>
<p>**Transaction Confirmation **</p>
<ul>
<li>Bitcoin network is a peer to peer network</li>
<li>Node connects to several other nodes in bitcoin network</li>
<li>Nodes exchange transactions and blocks</li>
<li>New transaction is flooded to all clients</li>
<li>New transaction will be validated by multiple nodes and added to the blockchain </li>
<li>Direct connection between input node and output node is not required</li>
</ul>
<p><strong>Bitcoin Mining</strong></p>
<ul>
<li>New transaction will be firstly added to the temporary pool of unverified transaction maintained by each node</li>
<li>Miner constructs a new block with the following elements<ul>
<li>Unverified transactions from temporary pool</li>
<li>Previous block reference</li>
<li>Transaction that pays his own bitcoin address as the block reward</li>
<li>Transaction fee of including all transaction in this block</li>
</ul>
</li>
<li>Miner proves the validity of his new block, which is computation intensive </li>
<li>Multiple miners are involved in the step (2) and (3), each includes a special transaction in his block (transaction fee)</li>
<li>The miners who firstly provides the proof of the validity of his block wins the competition and his block will be added to the blockchain</li>
</ul>
<p><strong>Nodes in Bitcoin Network</strong></p>
<ul>
<li>Full Nodes<ul>
<li>Core clients</li>
<li>Functionality: Wallet, miner, full blockchain storage, network routing functions</li>
</ul>
</li>
<li>SPV (Simplified Payment Verification) Nodes<ul>
<li>Lightweight clients</li>
<li>Wallet and network routing</li>
</ul>
</li>
<li>Pool protocol Servers<ul>
<li>Nonstandard nodes</li>
<li>Using alternative protocols, e.g. stratum protocol</li>
<li>Mainly for mining and compute hashes</li>
</ul>
</li>
</ul>
<p><strong>Bitcoin Wallets</strong></p>
<ul>
<li>Software which stores private or public keys and bitcoin address</li>
<li>Receiving bitcoins</li>
<li>Sending bitcoins</li>
<li>Do not store any coins</li>
<li>In bitcoin network, coins do not exist</li>
<li>Only transaction information is stored on the blockchain</li>
</ul>
<p><strong>Wallet Types</strong></p>
<ul>
<li>Non-deterministic wallets<ul>
<li>Contain randomly generated private keys (Just a bunch of Key wallets)</li>
<li>Bitcoin core client generates some keys when first started or when required</li>
<li>Managing a large number of key is very difficult and an error prone process (theft and loss of coins) and need to create regular backups</li>
</ul>
</li>
<li>Deterministic wallets<ul>
<li>Key are derived out of a seed value via hash functions</li>
<li>Seed number is generated randomly</li>
<li>Seed number is represented by human-readable mnemonic code words</li>
<li>All keys can be recovered by mnemonic code</li>
</ul>
</li>
<li>Hierarchical Deterministic Wallets<ul>
<li>Does not generate keys directly, it only produces some information that can be used to generate a sequence of private keys</li>
<li>Store keys in a tree structure derived from a seed</li>
<li>The seed generates the parent key (master key), which is used to generate child keys (which is used to generate grandchild keys</li>
<li>Easily recoverable, maintain</li>
<li>Highly portable</li>
</ul>
</li>
<li>Brain wallets<ul>
<li>Master private key is derived from the hash of passwords that are memorized</li>
<li>HD wallets derived from a single memorized password</li>
<li>Subject to password guessing and brute force attacks</li>
</ul>
</li>
<li>Paper wallets<ul>
<li>Required key material is printed on a paper</li>
</ul>
</li>
<li>Hardware wallets<ul>
<li>Use custom-built device or NFC-enabled phone to store keys</li>
</ul>
</li>
<li>Online wallets<ul>
<li>Store keys in cloud service provider</li>
<li>Users manage their keys via web interface</li>
</ul>
</li>
<li>Mobile wallets<ul>
<li>Wallets are installed on mobile device</li>
<li>Use camera to scan QR code and make payments</li>
</ul>
</li>
</ul>
<h4 id="8-8-Exercise"><a href="#8-8-Exercise" class="headerlink" title="8.8 Exercise"></a>8.8 Exercise</h4><p><strong>In-Class Exercise 1</strong></p>
<p><strong>Briefly describe how the public and private key are used in blockchain and bitcoin.</strong>  </p>
<p>Answers:</p>
<ul>
<li>Public key will be used as the address of the sender or the recipient of a transaction.  </li>
<li>Private key presents the ownership of the bitcoin and will be used to sign transactions (fund transfer).</li>
</ul>
<p><strong>In-Class Exercise 2</strong></p>
<p><strong>Consider the following Bitcoin transactions.</strong></p>
<img src="https://pic.imgdb.cn/item/6288983d09475431290f57b7.jpg" style="zoom:67%;" />

<p><strong>What is the value of X in the last transaction?</strong></p>
<p>X &#x3D; 0.3BTC （1.0 - 0.5 - 0.2）</p>
<p>**Suppose the following addresses are stored in Peter’s Wallet  **</p>
<p>**3xADF341e **</p>
<p><strong>a4Y0a23bb</strong></p>
<p><strong>What is the final balance of Peter’s Bitcoin account after all these transactions?</strong> </p>
<p>Ans &#x3D; 8.1BTC （7 + 0.9 + 0.2）</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://www.zzzzzq.com/2022/05/19/ELEC7078/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HKU/" rel="tag">HKU</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2022/05/20/project-in-meituan-02/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            project in meituan 02
          
        </div>
      </a>
    
    
      <a href="/2022/05/17/java-core/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">java核心技术记录</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.staticfile.org/valine/1.4.16/Valine.min.js"></script>
<script>
  new Valine({
    el: "#vcomments",
    app_id: "5J2nSr5DoqBGRRnpdFfTvawi-gzGzoHsz",
    app_key: "24GWRfKBASGr6cA5FSBF4NY4",
    path: window.location.pathname,
    avatar: "monsterid",
    placeholder: "给我的文章加点评论吧~",
    recordIP: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0px;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>

 
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022
        <i class="ri-heart-fill heart_icon"></i> ZHU
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Keep Making Progress"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>